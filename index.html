<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Bảng điều khiển Dữ liệu Supabase</title>
  
  <!-- Import Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- Import Font Awesome (cho các biểu tượng) -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" xintegrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" crossorigin="anonymous" referrerpolicy="no-referrer" />

  <style>
    /* Thêm một số style tùy chỉnh
      Chúng ta dùng @apply của Tailwind để tái sử dụng các class
    */
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      background-color: #f8f9fa; /* Màu nền xám nhạt */
    }

    /* Tùy chỉnh thanh cuộn */
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }
    ::-webkit-scrollbar-track {
      background: #f1f1f1;
      border-radius: 10px;
    }
    ::-webkit-scrollbar-thumb {
      background: #c0c0c0;
      border-radius: 10px;
    }
    ::-webkit-scrollbar-thumb:hover {
      background: #a0a0a0;
    }

    /* Kiểu của tab */
    .tab-button {
      @apply py-3 px-6 text-gray-600 font-semibold cursor-pointer border-b-4 border-transparent transition-all;
    }
    .tab-button.active {
      @apply text-blue-600 border-blue-600;
    }
    .tab-button:hover {
      @apply bg-gray-100;
    }
    
    /* Kiểu của nút cài đặt */
    .settings-panel {
      @apply absolute right-0 top-full mt-2 w-64 bg-white rounded-lg shadow-xl p-4 z-50;
      display: none; /* Ẩn ban đầu */
    }
  </style>
</head>
<body class="text-gray-800">

  <!-- ===== HEADER & NAVIGATION ===== -->
  <header class="bg-white shadow-md sticky top-0 z-40">
    <div class="container mx-auto px-4">
      <div class="flex justify-between items-center h-16">
        
        <!-- Tabs điều hướng -->
        <nav class="flex h-full">
          <!-- 
            Chúng ta thêm data-tab="ten-tab" để JS biết
            nút này tương ứng với nội dung nào 
          -->
          <!-- THAY ĐỔI 1: Sửa tab đầu tiên thành "Vật Tư" (SANPHAM) và đặt làm active -->
          <button class="tab-button active" data-tab="sanpham">
            Vật Tư
          </button>
          <!-- THAY ĐỔI 2: Thêm tab "Tồn Kho" (TONKHO) -->
          <button class="tab-button" data-tab="tonkho">
            Tồn Kho
          </button>
          <button class="tab-button" data-tab="donhang">
            Đơn Hàng
          </button>
          <!-- THAY ĐỔI 3: Sửa tab cuối cùng thành "Chi Tiết" -->
          <button class="tab-button" data-tab="chitiet">
            Chi Tiết
          </button>
        </nav>

        <!-- Thanh tìm kiếm và Cài đặt -->
        <div class="flex items-center space-x-4">
          <div class="relative">
            <input type="text" placeholder="Tìm kiếm..." class="border rounded-full py-2 px-4 pl-10 text-sm w-64 focus:outline-none focus:ring-2 focus:ring-blue-500">
            <i class="fa-solid fa-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
          </div>

          <!-- Nút Cài Đặt (theo yêu cầu) -->
          <div class="relative" id="settings-menu">
            <button id="settings-button" class="text-gray-600 hover:text-blue-600 transition-colors">
              <i class="fa-solid fa-gear fa-lg"></i>
            </button>
            
            <!-- Bảng điều khiển Cài Đặt -->
            <div id="settings-panel" class="settings-panel">
              <label for="font-slider" class="block text-sm font-medium text-gray-700">
                Kích thước chữ: <span id="font-size-label" class="font-bold text-blue-600">14</span>px
              </label>
              <input 
                type="range" 
                id="font-slider" 
                min="10" 
                max="20" 
                value="14" 
                class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer mt-2"
              >
              <div class="text-xs text-gray-500 flex justify-between mt-1">
                <span>10px</span>
                <span>20px</span>
              </div>
            </div>
          </div>
          
          <i class="fa-solid fa-sync text-gray-600 cursor-pointer" title="Đồng bộ"></i>
        </div>
      </div>
    </div>
  </header>

  <!-- ===== MAIN CONTENT ===== -->
  <main class="container mx-auto p-4">
    
    <!-- 
      Đây là nơi chứa nội dung của các tab 
      Chúng ta dùng class "tab-content" để JS nhận diện
    -->

    <!-- ===== THAY ĐỔI 4: Thêm nội dung TAB VẬT TƯ (SANPHAM) ===== -->
    <div id="sanpham-content" class="tab-content" style="display: none;">
      <!-- Toolbar -->
      <div class="bg-white p-4 rounded-lg shadow mb-4">
        <div class="flex justify-between items-center mb-4">
          <h2 class="text-xl font-semibold">Quản lý Vật Tư (SANPHAM)</h2>
          <div class="flex space-x-2">
            <!-- Các nút Thêm/Lưu/Xóa có thể thêm chức năng sau -->
            <button class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded transition-colors"><i class="fa-solid fa-plus mr-2"></i>Thêm</button>
            <button class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded transition-colors"><i class="fa-solid fa-save mr-2"></i>Lưu</button>
            <button class="bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded transition-colors"><i class="fa-solid fa-trash mr-2"></i>Xóa</button>
          </div>
        </div>
      </div>
      <!-- Bảng Dữ Liệu Vật Tư -->
      <!-- THÊM CLASS 'data-table-wrapper' -->
      <div class="bg-white rounded-lg shadow overflow-auto data-table-wrapper">
        <table class="min-w-full divide-y divide-gray-200 whitespace-nowrap">
          <thead class="bg-gray-50 sticky top-0 z-10">
            <tr>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"><input type="checkbox"></th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Mã Viết Tắt</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tên Vật Tư</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Ngành</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Phụ Trách</th>
            </tr>
          </thead>
          <tbody id="sanpham-body" class="bg-white divide-y divide-gray-200">
            <!-- JS sẽ chèn dữ liệu vào đây -->
            <tr><td colspan="5" class="px-6 py-20 text-center text-gray-500"><i class="fa-solid fa-spinner fa-spin fa-2x"></i><p class="mt-2">Đang tải dữ liệu...</p></td></tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- ===== NỘI DUNG TAB TỒN KHO (TONKHO) ===== -->
    <!-- Sửa lại: Tên tab là Tồn Kho, ẩn nó đi -->
    <div id="tonkho-content" class="tab-content" style="display: none;">
      
      <!-- Toolbar (giống ảnh 2) -->
      <div class="bg-white p-4 rounded-lg shadow mb-4">
        <div class="flex justify-between items-center mb-4">
          <h2 class="text-xl font-semibold">Quản lý Tồn Kho (TONKHO)</h2>
          <div class="flex space-x-2">
            <button class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded transition-colors"><i class="fa-solid fa-plus mr-2"></i>Thêm</button>
            <button class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded transition-colors"><i class="fa-solid fa-save mr-2"></i>Lưu</button>
            <button class="bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded transition-colors"><i class="fa-solid fa-trash mr-2"></i>Xóa</button>
          </div>
        </div>
        
        <!-- Filters (Placeholder) -->
        <div class="grid grid-cols-4 lg:grid-cols-7 gap-3">
          <input type="text" placeholder="Mã Viết Tắt" class="border rounded px-3 py-2 text-sm focus:outline-none focus:ring-1 focus:ring-blue-500">
          <input type="text" placeholder="Số Lô" class="border rounded px-3 py-2 text-sm focus:outline-none focus:ring-1 focus:ring-blue-500">
          <input type="text" placeholder="Tình Trạng" class="border rounded px-3 py-2 text-sm focus:outline-none focus:ring-1 focus:ring-blue-500">
          <input type="text" placeholder="Tray" class="border rounded px-3 py-2 text-sm focus:outline-none focus:ring-1 focus:ring-blue-500">
          <input type="text" placeholder="Ngành" class="border rounded px-3 py-2 text-sm focus:outline-none focus:ring-1 focus:ring-blue-500">
          <input type="text" placeholder="Phụ Trách" class="border rounded px-3 py-2 text-sm focus:outline-none focus:ring-1 focus:ring-blue-500">
          <button class="bg-gray-700 hover:bg-gray-800 text-white font-bold py-2 px-4 rounded transition-colors col-span-4 lg:col-span-1"><i class="fa-solid fa-filter mr-2"></i>Lọc</button>
        </div>
      </div>

      <!-- Bảng Dữ Liệu Tồn Kho -->
      <!-- 
        Chúng ta bọc bảng trong 1 div để có thể cuộn ngang 
        Và đặt ID để JS có thể điều khiển font-size 
      -->
      <!-- SỬA ID THÀNH CLASS 'data-table-wrapper' -->
      <div class="bg-white rounded-lg shadow overflow-auto data-table-wrapper">
        <table class="min-w-full divide-y divide-gray-200 whitespace-nowrap">
          <thead class="bg-gray-50 sticky top-0 z-10">
            <tr>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"><input type="checkbox"></th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Mã Viết Tắt</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tên Vật Tư</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Số LOT</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tồn Đầu</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nhập</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Xuất</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tồn Cuối</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tình Trạng</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Mã Vạch</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tray</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Ngành</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Phụ Trách</th>
            </tr>
          </thead>
          <!-- Đây là nơi JS sẽ chèn dữ liệu vào -->
          <tbody id="tonkho-body" class="bg-white divide-y divide-gray-200">
            <!-- Dữ liệu mẫu (sẽ bị JS xóa) -->
            <tr>
              <td colspan="14" class="px-6 py-20 text-center text-gray-500">
                <i class="fa-solid fa-spinner fa-spin fa-2x"></i>
                <p class="mt-2">Đang tải dữ liệu...</p>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- ===== NỘI DUNG TAB ĐƠN HÀNG ===== -->
    <!-- THAY ĐỔI 5: Thay thế nội dung placeholder bằng bảng biểu -->
    <div id="donhang-content" class="tab-content bg-white p-6 rounded-lg shadow" style="display: none;">
      <h2 class="text-xl font-semibold mb-4">Quản lý Đơn Hàng (DONHANG)</h2>
      <!-- Bảng Dữ Liệu Đơn Hàng -->
      <!-- THÊM CLASS 'data-table-wrapper' -->
      <div class="bg-white rounded-lg shadow overflow-auto data-table-wrapper">
        <table class="min-w-full divide-y divide-gray-200 whitespace-nowrap">
          <thead class="bg-gray-50 sticky top-0 z-10">
            <tr>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"><input type="checkbox"></th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Mã Kho</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Thời Gian</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Mã NX</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">User</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Ngành</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Mục Đích</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Địa Chỉ</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Ghi Chú</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Order</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">PKL</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Done</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Image</th>
            </tr>
          </thead>
          <tbody id="donhang-body" class="bg-white divide-y divide-gray-200">
             <!-- JS sẽ chèn dữ liệu vào đây -->
            <tr><td colspan="13" class="px-6 py-20 text-center text-gray-500"><i class="fa-solid fa-spinner fa-spin fa-2x"></i><p class="mt-2">Đang tải dữ liệu...</p></td></tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- ===== NỘI DUNG TAB THẺ KHO (CHI TIẾT) ===== -->
    <!-- THAY ĐỔI 6: Thay thế nội dung placeholder bằng bảng biểu -->
    <div id="chitiet-content" class="tab-content bg-white p-6 rounded-lg shadow" style="display: none;">
      <h2 class="text-xl font-semibold mb-4">Quản lý Chi Tiết (CHITIET)</h2>
      <!-- Bảng Dữ Liệu Chi Tiết -->
       <!-- THÊM CLASS 'data-table-wrapper' -->
       <div class="bg-white rounded-lg shadow overflow-auto data-table-wrapper">
        <table class="min-w-full divide-y divide-gray-200 whitespace-nowrap">
          <thead class="bg-gray-50 sticky top-0 z-10">
            <tr>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"><input type="checkbox"></th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ID</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Mã Kho</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Mã NX</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Mã VT</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tên VT</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Lot</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Yêu Cầu</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Số Lượng</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Loại</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">User</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Mục Đích</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Ngành</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Phụ Trách</th>
            </tr>
          </thead>
          <tbody id="chitiet-body" class="bg-white divide-y divide-gray-200">
             <!-- JS sẽ chèn dữ liệu vào đây -->
            <tr><td colspan="15" class="px-6 py-20 text-center text-gray-500"><i class="fa-solid fa-spinner fa-spin fa-2x"></i><p class="mt-2">Đang tải dữ liệu...</p></td></tr>
          </tbody>
        </table>
      </div>
    </div>
    
  </main>

  <!-- ===== JAVASCRIPT ===== -->
  <script>
    // Chờ cho đến khi toàn bộ trang HTML được tải xong
    document.addEventListener('DOMContentLoaded', () => {
      
      // === CÀI ĐẶT ===
      const settingsButton = document.getElementById('settings-button');
      const settingsPanel = document.getElementById('settings-panel');
      const fontSlider = document.getElementById('font-slider');
      const fontLabel = document.getElementById('font-size-label');
      // SỬA: Chọn tất cả các bảng bằng class
      const dataTableContainers = document.querySelectorAll('.data-table-wrapper');

      // Mở/đóng bảng Cài đặt
      settingsButton.addEventListener('click', () => {
        settingsPanel.style.display = settingsPanel.style.display === 'block' ? 'none' : 'block';
      });

      // Xử lý khi click bên ngoài để đóng bảng Cài đặt
      document.addEventListener('click', (e) => {
        if (!settingsButton.contains(e.target) && !settingsPanel.contains(e.target)) {
          settingsPanel.style.display = 'none';
        }
      });

      // Xử lý thanh trượt Font Size (theo yêu cầu)
      fontSlider.addEventListener('input', (e) => {
        const fontSize = e.target.value;
        fontLabel.textContent = fontSize; // Cập nhật nhãn
        // SỬA: Áp dụng font-size cho TẤT CẢ các bảng
        dataTableContainers.forEach(container => {
          container.style.fontSize = fontSize + 'px';
        });
      });
      // Đặt giá trị font-size ban đầu khi tải trang
      // SỬA: Áp dụng font-size cho TẤT CẢ các bảng
      dataTableContainers.forEach(container => {
        container.style.fontSize = fontSlider.value + 'px';
      });


      // === ĐIỀU HƯỚNG TAB ===
      const tabButtons = document.querySelectorAll('.tab-button');
      const tabContents = document.querySelectorAll('.tab-content');

      tabButtons.forEach(button => {
        button.addEventListener('click', () => {
          // Lấy tên tab từ thuộc tính data-tab
          const tabName = button.dataset.tab;
          
          // Xóa class 'active' khỏi tất cả các nút
          tabButtons.forEach(btn => btn.classList.remove('active'));
          // Thêm class 'active' cho nút vừa click
          button.classList.add('active');
          
          // Ẩn tất cả nội dung tab
          tabContents.forEach(content => {
            content.style.display = 'none';
          });
          
          // Hiển thị nội dung tab tương ứng
          document.getElementById(tabName + '-content').style.display = 'block';
        });
      });


      // === TẢI DỮ LIỆU ===
      const API_URL = 'http://localhost:3000/api/all-data';

      // Lấy các thẻ <tbody>
      // THAY ĐỔI 7: Thêm sanphamBody
      const sanphamBody = document.getElementById('sanpham-body');
      const tonkhoBody = document.getElementById('tonkho-body');
      const donhangBody = document.getElementById('donhang-body');
      const chitietBody = document.getElementById('chitiet-body');

      // Dùng hàm tiện ích để tránh lỗi null/undefined
      const val = (field) => field || ''; 

      // THAY ĐỔI 8: Thêm Hàm Render Bảng Vật Tư (SANPHAM)
      function renderSanPhamTable(data) {
        sanphamBody.innerHTML = '';
        if (!data || data.length === 0) {
          sanphamBody.innerHTML = '<tr><td colspan="5" class="px-6 py-10 text-center text-gray-500">Không có dữ liệu Vật tư.</td></tr>';
          return;
        }
        data.forEach(row => {
          const tr = document.createElement('tr');
          tr.className = 'hover:bg-gray-50 transition-colors';
          tr.innerHTML = `
            <td class="px-6 py-3"><input type="checkbox" class="rounded"></td>
            <td class="px-6 py-3 text-sm font-medium text-gray-900">${val(row.ma_vt)}</td>
            <td class="px-6 py-3 text-sm">${val(row.ten_vt)}</td>
            <td class="px-6 py-3 text-sm">${val(row.nganh)}</td>
            <td class="px-6 py-3 text-sm">${val(row.phu_trach)}</td>
          `;
          sanphamBody.appendChild(tr);
        });
      }

      // Hàm Render Bảng Tồn Kho
      function renderTonKhoTable(data) {
        // Xóa nội dung "Đang tải..."
        tonkhoBody.innerHTML = '';
        
        if (!data || data.length === 0) {
          tonkhoBody.innerHTML = '<tr><td colspan="14" class="px-6 py-10 text-center text-gray-500">Không có dữ liệu Tồn kho.</td></tr>';
          return;
        }
        
        // Lặp qua từng dòng dữ liệu để tạo hàng
        data.forEach(row => {
          const tr = document.createElement('tr');
          tr.className = 'hover:bg-gray-50 transition-colors';
          // Dùng hàm tiện ích để tránh lỗi null/undefined
          const val = (field) => field || ''; 

          tr.innerHTML = `
            <td class="px-6 py-3"><input type="checkbox" class="rounded"></td>
            <td class="px-6 py-3 text-sm font-medium text-gray-900">${val(row.ma_vt)}</td>
            <td class="px-6 py-3 text-sm">${val(row.ten_vt)}</td>
            <td class="px-6 py-3 text-sm">${val(row.lot)}</td>
            <td class="px-6 py-3 text-sm">${val(row.date)}</td>
            <td class="px-6 py-3 text-sm text-right">${val(row.ton_dau)}</td>
            <td class="px-6 py-3 text-sm text-right text-green-600 font-semibold">${val(row.nhap)}</td>
            <td class="px-6 py-3 text-sm text-right text-red-600 font-semibold">${val(row.xuat)}</td>
            <td class="px-6 py-3 text-sm text-right font-bold">${val(row.ton_cuoi)}</td>
            <td class="px-6 py-3 text-sm">${val(row.tinh_trang)}</td>
            <td class="px-6 py-3 text-sm">${val(row.ma_vach)}</td>
            <td class="px-6 py-3 text-sm">${val(row.tray)}</td>
            <td class="px-6 py-3 text-sm">${val(row.nganh)}</td>
            <td class="px-6 py-3 text-sm">${val(row.phu_trach)}</td>
          `;
          tonkhoBody.appendChild(tr);
        });
      }

      // Hàm Render Bảng Đơn Hàng (Đơn giản)
      // THAY ĐỔI 9: Cập nhật hàm render Đơn Hàng
      function renderDonHangTable(data) {
        donhangBody.innerHTML = '';
        if (!data || data.length === 0) {
          donhangBody.innerHTML = '<tr><td colspan="13" class="px-6 py-10 text-center text-gray-500">Không có dữ liệu Đơn hàng.</td></tr>';
          return;
        }
        data.forEach(row => {
          const tr = document.createElement('tr');
          tr.className = 'hover:bg-gray-50 transition-colors';
          tr.innerHTML = `
            <td class="px-6 py-3"><input type="checkbox" class="rounded"></td>
            <td class="px-6 py-3 text-sm">${val(row.ma_kho)}</td>
            <td class="px-6 py-3 text-sm">${val(row.thoi_gian)}</td>
            <td class="px-6 py-3 text-sm">${val(row.ma_nx)}</td>
            <td class="px-6 py-3 text-sm">${val(row.user)}</td>
            <td class="px-6 py-3 text-sm">${val(row.nganh)}</td>
            <td class="px-6 py-3 text-sm">${val(row.muc_dich)}</td>
            <td class="px-6 py-3 text-sm">${val(row.dia_chi)}</td>
            <td class="px-6 py-3 text-sm">${val(row.ghi_chu)}</td>
            <td class="px-6 py-3 text-sm">${val(row.order)}</td>
            <td class="px-6 py-3 text-sm">${val(row.pkl)}</td>
            <td class="px-6 py-3 text-sm">${val(row.done)}</td>
            <td class="px-6 py-3 text-sm">${val(row.image)}</td>
          `;
          donhangBody.appendChild(tr);
        });
      }
      
      // Hàm Render Bảng Chi Tiết (Đơn giản)
      // THAY ĐỔI 10: Cập nhật hàm render Chi Tiết
      function renderChiTietTable(data) {
        chitietBody.innerHTML = '';
         if (!data || data.length === 0) {
          chitietBody.innerHTML = '<tr><td colspan="15" class="px-6 py-10 text-center text-gray-500">Không có dữ liệu Chi tiết.</td></tr>';
          return;
        }
        data.forEach(row => {
          const tr = document.createElement('tr');
          tr.className = 'hover:bg-gray-50 transition-colors';
          tr.innerHTML = `
            <td class="px-6 py-3"><input type="checkbox" class="rounded"></td>
            <td class="px-6 py-3 text-sm font-medium text-gray-900">${val(row.id)}</td>
            <td class="px-6 py-3 text-sm">${val(row.ma_kho)}</td>
            <td class="px-6 py-3 text-sm">${val(row.ma_nx)}</td>
            <td class="px-6 py-3 text-sm">${val(row.ma_vt)}</td>
            <td class="px-6 py-3 text-sm">${val(row.ten_vt)}</td>
            <td class="px-6 py-3 text-sm">${val(row.lot)}</td>
            <td class="px-6 py-3 text-sm">${val(row.date)}</td>
            <td class="px-6 py-3 text-sm">${val(row.yeu_cau)}</td>
            <td class="px-6 py-3 text-sm text-right font-semibold">${val(row.so_luong)}</td>
            <td class="px-6 py-3 text-sm">${val(row.loai)}</td>
            <td class="px-6 py-3 text-sm">${val(row.user)}</td>
            <td class="px-6 py-3 text-sm">${val(row.muc_dich)}</td>
            <td class="px-6 py-3 text-sm">${val(row.nganh)}</td>
            <td class="px-6 py-3 text-sm">${val(row.phu_trach)}</td>
          `;
          chitietBody.appendChild(tr);
        });
      }

      // Hàm bất đồng bộ để gọi API
      async function layDuLieu() {
        try {
          const response = await fetch(API_URL);
          if (!response.ok) {
            throw new Error(`Lỗi máy chủ: ${response.status}`);
          }
          const data = await response.json();

          // Gọi các hàm render cho từng bảng
          // THAY ĐỔI 11: Thêm renderSanPhamTable
          renderSanPhamTable(data.SANPHAM);
          renderTonKhoTable(data.TONKHO);
          renderDonHangTable(data.DONHANG);
          renderChiTietTable(data.CHITIET);

        } catch (error) {
          console.error('Lỗi khi lấy dữ liệu:', error);
          // Hiển thị lỗi trên bảng
          tonkhoBody.innerHTML = `
            <tr>
              <td colspan="14" class="px-6 py-20 text-center text-red-500">
                <i class="fa-solid fa-circle-exclamation fa-2x"></i>
                <p class="mt-2 font-semibold">Không thể tải dữ liệu</p>
                <p class="text-sm text-gray-600">${error.message}. Bạn đã chạy 'npm run dev' chưa?</p>
              </td>
            </tr>`;
        }
      }

      // Gọi hàm này ngay khi trang được tải
      layDuLieu();

      // THAY ĐỔI 12: Chủ động hiển thị tab "sanpham" (Vật Tư) mặc định
      document.getElementById('sanpham-content').style.display = 'block';
    });
  </script>

</body>
</html>





