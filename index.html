<!DOCTYPE html>
<!-- THAY ĐỔI: Thêm class="" để JS có thể toggle 'dark' -->
<html lang="vi" class="">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- 1. Tải Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- MỚI: Tải Animated Icons -->
  <script src="https://animatedicons.co/scripts/embed-animated-icons.js"></script>
  <!-- 2. Tải Supabase Client -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <!-- MỚI: Tải thư viện XLSX (SheetJS) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <!-- 3. Tải Font (Inter) -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    /* Kiểu chữ mặc định */
    /* MỚI: Sử dụng font-size cho thẻ html để dễ dàng scale toàn bộ ứng dụng */
    html {
        font-size: 100%; /* Default scale */
    }
    body {
      font-family: 'Inter', sans-serif;
    }

    /* Ẩn/hiện các view */
    .view {
      display: none;
    }

    .view.active {
      display: block;
    }

    /* Tùy chỉnh thanh cuộn */
    ::-webkit-scrollbar {
      width: 6px;
      height: 6px;
    }

    ::-webkit-scrollbar-thumb {
      background: #9ca3af;
      /* gray-400 */
      border-radius: 10px;
    }

    ::-webkit-scrollbar-track {
      background: #e5e7eb;
      /* gray-200 */
    }

    /* Kiểu thanh điều hướng (Tabs) */
    .nav-link {
      display: inline-block;
      padding: 16px 20px;
      font-weight: 500;
      color: #4b5563;
      /* gray-600 */
      border-bottom: 4px solid transparent;
      transition: all 0.2s ease-in-out;
    }

    .nav-link:hover {
      color: #3b82f6;
      /* blue-500 */
    }

    .nav-link.active {
      color: #2563eb;
      /* blue-600 */
      font-weight: 600;
      border-bottom-color: #2563eb;
    }

    /* Kiểu hàng được chọn */
    .selectable-row.selected {
      background-color: #dbeafe;
      /* blue-100 */
    }
    /* THÊM MỚI: Dark mode cho hàng được chọn */
    .dark .selectable-row.selected {
      background-color: #1e3a8a; /* blue-900 */
    }

    .selectable-row {
      cursor: pointer;
    }

    /* Input cho chỉnh sửa nội tuyến */
    .inline-input, .inline-input-text {
      width: 100%;
      padding: 4px 8px;
      border: 1px solid #9ca3af;
      /* gray-400 */
      border-radius: 4px;
      background-color: #f0f9ff;
      /* blue-50 */
    }

    /* THÊM MỚI: Style cho input chỉ đọc */
    .inline-input[readonly] {
        background-color: #f3f4f6; /* gray-100 */
        cursor: not-allowed;
    }
    .dark .inline-input[readonly] {
        background-color: #374151; /* gray-700 */
    }

    .inline-input-text {
        background-color: #f3f4f6; /* gray-100 */
    }
    /* THÊM MỚI: Dark mode cho inline input */
    .dark .inline-input {
      background-color: #1f2937; /* gray-800 */
      border-color: #4b5563; /* gray-600 */
      color: #e5e7eb; /* gray-200 */
    }
    .dark .inline-input-text {
        background-color: #374151; /* gray-700 */
    }

    .inline-input:focus {
      outline: none;
      border-color: #2563eb;
      /* blue-600 */
      box-shadow: 0 0 0 2px #dbeafe;
      /* blue-100 */
    }
    /* THÊM MỚI: Dark mode cho inline input focus */
    .dark .inline-input:focus {
      border-color: #3b82f6; /* blue-500 */
      box-shadow: 0 0 0 2px #1e3a8a; /* blue-900 */
    }
    
    /* Input có nền xám */
    .inline-input.bg-gray-input, .inline-input-text.bg-gray-input {
        background-color: #f3f4f6; /* gray-100 */
        cursor: not-allowed;
    }
    .dark .inline-input.bg-gray-input, .dark .inline-input-text.bg-gray-input {
        background-color: #374151; /* gray-700 */
    }


    /* MỚI: Tùy chỉnh select cho bộ lọc */
    .filter-select {
      /* Đảm bảo select có chiều cao giống input/button */
      padding-top: 0.5rem;
      padding-bottom: 0.5rem;
      /* Thêm-webkit-appearance để ghi đè style trình duyệt */
      -webkit-appearance: none;
      appearance: none;
      background-image: url('data:image/svg+xml;charset=UTF-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="none" stroke="%236b7280" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6 9l6 6 6-6"/></svg>');
      background-size: 1.25rem;
      background-repeat: no-repeat;
      background-position: right 0.5rem center;
      padding-right: 2.5rem;
      /* Thêm padding phải để text không đè lên icon */
    }
    /* THÊM MỚI: Dark mode cho filter select */
    .dark .filter-select {
      background-color: #374151; /* gray-700 */
      border-color: #4b5563; /* gray-600 */
      color: #e5e7eb; /* gray-200 */
      background-image: url('data:image/svg+xml;charset=UTF-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="none" stroke="%23d1d5db" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6 9l6 6 6-6"/></svg>');
    }

    /* MỚI: CSS cho bộ lọc custom */
    .custom-filter-toggle {
      width: 100%;
      background-color: white;
      border: 1px solid #d1d5db; /* gray-300 */
      border-radius: 0.375rem; /* rounded-md */
      padding: 0.5rem 0.75rem;
      text-align: left;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05); /* shadow-sm */
    }
    /* THÊM MỚI: Dark mode */
    .dark .custom-filter-toggle {
      background-color: #374151; /* gray-700 */
      border-color: #4b5563; /* gray-600 */
    }
    .custom-filter-toggle:focus {
      outline: none;
      border-color: #2563eb; /* blue-600 */
      box-shadow: 0 0 0 2px #dbeafe; /* blue-100 */
    }
    /* THÊM MỚI: Dark mode */
    .dark .custom-filter-toggle:focus {
      border-color: #3b82f6; /* blue-500 */
      box-shadow: 0 0 0 2px #1e3a8a; /* blue-900 */
    }
    .custom-filter-text {
      color: #374151; /* gray-700 */
    }
    /* THÊM MỚI: Dark mode */
    .dark .custom-filter-text {
      color: #e5e7eb; /* gray-200 */
    }
    .custom-filter-arrow {
      width: 1.25rem; /* w-5 */
      height: 1.25rem; /* h-5 */
      color: #6b7280; /* gray-500 */
    }
    /* THÊM MỚI: Dark mode */
    .dark .custom-filter-arrow {
      color: #9ca3af; /* gray-400 */
    }
    .custom-filter-panel {
      position: absolute;
      background-color: white;
      border: 1px solid #d1d5db; /* gray-300 */
      border-radius: 0.375rem; /* rounded-md */
      margin-top: 0.25rem; /* mt-1 */
      width: 100%;
      z-index: 50;
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); /* shadow-lg */
      padding: 0.5rem; /* p-2 */
    }
    /* THÊM MỚI: Dark mode */
    .dark .custom-filter-panel {
      background-color: #1f2937; /* gray-800 */
      border-color: #4b5563; /* gray-600 */
    }
    .custom-filter-search {
      width: 100%;
      padding: 0.5rem 0.75rem; /* px-3 py-2 */
      border: 1px solid #d1d5db; /* gray-300 */
      border-radius: 0.375rem; /* rounded-md */
      margin-bottom: 0.5rem; /* mb-2 */
      font-size: 0.875rem; /* text-sm */
    }
    /* THÊM MỚI: Dark mode */
    .dark .custom-filter-search {
      background-color: #374151; /* gray-700 */
      border-color: #4b5563; /* gray-600 */
      color: #e5e7eb; /* gray-200 */
    }
    .custom-filter-search:focus {
      outline: none;
      border-color: #2563eb; /* blue-600 */
    }
    /* THÊM MỚI: Dark mode */
    .dark .custom-filter-search:focus {
      border-color: #3b82f6; /* blue-500 */
    }
    .custom-filter-list {
      max-height: 200px;
      overflow-y: auto;
      font-size: 0.875rem; /* text-sm */
    }
    .custom-filter-item {
      display: flex;
      align-items: center;
      padding: 0.5rem; /* p-2 */
      cursor: pointer;
      border-radius: 0.25rem; /* rounded */
    }
    .custom-filter-item:hover {
      background-color: #f3f4f6; /* gray-100 */
    }
    /* THÊM MỚI: Dark mode */
    .dark .custom-filter-item:hover {
      background-color: #374151; /* gray-700 */
    }
    .custom-filter-item input {
      margin-right: 0.5rem; /* mr-2 */
      cursor: pointer;
    }
    .custom-filter-item label {
      color: #374151; /* gray-700 */
      cursor: pointer;
      /* Cho phép ngắt dòng nếu text quá dài */
      white-space: normal;
      word-break: break-word;
    }
    /* THÊM MỚI: Dark mode */
    .dark .custom-filter-item label {
      color: #e5e7eb; /* gray-200 */
    }

    /* THÊM MỚI: CSS cho Toast Notification */
    .toast {
      padding: 1rem 1.5rem;
      border-radius: 0.5rem; /* rounded-lg */
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06); /* shadow-md */
      color: white;
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 0.75rem; /* gap-3 */
      opacity: 0;
      transform: translateX(100%);
      transition: all 0.3s ease-in-out;
    }
    .toast.show {
      opacity: 1;
      transform: translateX(0);
    }
    .toast.hide {
      opacity: 0;
      transform: translateX(100%);
    }
    .toast-success { background-color: #16a34a; } /* green-600 */
    .toast-warning { background-color: #f59e0b; } /* amber-500 */
    .toast-error   { background-color: #dc2626; } /* red-600 */

    /* THÊM MỚI: CSS cho thanh tiến trình (Progress Bar) */
    #loading-progress-bar {
      display: none; /* Ẩn mặc định */
      position: absolute;
      bottom: -1px; /* Nằm ngay dưới border của header */
      left: 0;
      width: 100%;
      height: 3px;
      background-color: #dbeafe; /* blue-100 */
      overflow: hidden;
    }
    .dark #loading-progress-bar {
       background-color: #1e3a8a; /* blue-900 */
    }
    #loading-progress-bar-inner {
      width: 100%;
      height: 100%;
      background-color: #3b82f6; /* blue-500 */
      animation: loading-animation 2s infinite linear;
    }
    @keyframes loading-animation {
      0% { transform: translateX(-100%); }
      100% { translateX(100%); }
    }

    /* CSS cho bảng (dùng chung) */
    .th {
      /* MỚI: Cố định tiêu đề */
      position: sticky;
      top: 0;
      z-index: 10;
      /* THAY ĐỔI THEO YÊU CẦU: Đậm hơn */
      background-color: #e5e7eb; /* bg-gray-200 */

      padding: 12px 16px;
      text-align: left;
      font-size: 0.75rem;
      /* THAY ĐỔI THEO YÊU CẦU: Đậm hơn */
      font-weight: 700; /* bold */
      color: #1f2937; /* gray-800 */
      text-transform: uppercase;
      letter-spacing: 0.05em;
      vertical-align: top;
      /* Căn lề cho input nội tuyến */
      
      /* MỚI: Thêm border giống Excel */
      border-bottom: 1px solid #d1d5db; /* gray-300 */
      border-right: 1px solid #d1d5db; /* gray-300 */
    }
    /* THÊM MỚI: Dark mode cho .th */
    .dark .th {
      background-color: #374151; /* gray-700 */
      color: #e5e7eb; /* gray-200 */
      border-color: #4b5563; /* gray-600 */
    }

    /* MỚI: Thêm border trái cho ô đầu tiên */
    .th:first-child, .td:first-child {
        border-left: 1px solid #d1d5db; /* gray-300 */
    }
    /* THÊM MỚI: Dark mode */
    .dark .th:first-child, .dark .td:first-child {
        border-left-color: #4b5563; /* gray-600 */
    }

    .td {
      padding: 12px 16px;
      vertical-align: top;
      /* MỚI: Cho phép ngắt dòng nếu nội dung quá dài */
      word-break: break-word;
      
      /* MỚI: Thêm border giống Excel */
      border-bottom: 1px solid #d1d5db; /* gray-300 */
      border-right: 1px solid #d1d5db; /* gray-300 */
    }
    /* THÊM MỚI: Dark mode cho .td */
    .dark .td {
      border-color: #4b5563; /* gray-600 */
    }

    .td-center {
      padding: 12px 16px;
      text-align: center;
      color: #6b7280;
      /* gray-500 */
    }
    /* THÊM MỚI: Dark mode */
    .dark .td-center {
      color: #9ca3af; /* gray-400 */
    }

    /* MỚI: CSS cho màu chữ cột */
    .text-nhap { color: #16a34a; } /* green-600 */
    .dark .text-nhap { color: #22c55e; } /* green-500 */
    .text-xuat { color: #dc2626; } /* red-600 */
    .dark .text-xuat { color: #ef4444; } /* red-500 */

    .status-het-date { color: #dc2626; font-weight: 500; } /* red-600 */
    .dark .status-het-date { color: #ef4444; } /* red-500 */
    .status-can-date { color: #f59e0b; font-weight: 500; } /* amber-500 */
    .dark .status-can-date { color: #fcd34d; } /* amber-300 */
    .status-binh-thuong { color: #16a34a; font-weight: 500; } /* green-600 */
    .dark .status-binh-thuong { color: #22c55e; } /* green-500 */
    .status-hang-hu { color: #1f2937; font-weight: 700; } /* gray-800 */
    .dark .status-hang-hu { color: #f9fafb; font-weight: 700; } /* gray-50 */

    /* CSS cho modal */
    .modal-content {
      max-height: 70vh;
      overflow-y: auto;
    }
    /* THÊM MỚI: Dark mode */
    .dark .modal-content {
      background-color: #1f2937; /* gray-800 */
    }

    /* CSS cho .btn-cancel và .btn-save (dùng trong modal confirm) */
    @tailwind base;
    @tailwind components;
    @tailwind utilities;

    @layer components {
      .btn-cancel {
        @apply px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 transition;
      }
      /* THÊM MỚI: Dark mode */
      .dark .btn-cancel {
         @apply bg-gray-600 text-gray-200 hover:bg-gray-500;
      }
    }

    /* =================================== */
    /* ===== CSS MỚI CHO MODAL ĐƠN HÀNG ===== */
    /* =================================== */

    #donhang-modal {
      display: flex; /* Thay đổi từ 'none' để dùng với class 'hidden' của tailwind */
    }

    #donhang-modal.hidden {
      display: none;
    }

    .section-title {
      font-size: 1.125rem; /* text-lg */
      font-weight: 600;
      color: #1d4ed8; /* blue-700 */
      padding-bottom: 0.5rem;
      border-bottom: 1px solid #e5e7eb; /* border-gray-200 */
      margin-bottom: 0.5rem;
    }

    .form-label {
      display: block;
      margin-bottom: 0.25rem;
      font-size: 0.875rem; /* text-sm */
      font-weight: 500;
      color: #374151; /* gray-700 */
    }

    .form-input, .form-textarea {
      width: 100%;
      padding: 0.5rem 0.75rem;
      border: 1px solid #d1d5db; /* gray-300 */
      border-radius: 0.375rem; /* rounded-md */
      box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05); /* shadow-sm */
      transition: border-color 0.2s;
    }
    .form-input:focus, .form-textarea:focus {
      outline: none;
      border-color: #3b82f6; /* blue-500 */
      box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.2);
    }

    .form-textarea {
      resize: vertical;
    }

    /* ===== ENHANCED EXCEL-LIKE TABLE STYLES ===== */
    #donhang-modal-details-table {
      border-collapse: collapse;
      table-layout: fixed;
      width: 100%;
      border: 2px solid #d1d5db;
    }

    .th-modal {
      position: sticky;
      top: 0;
      padding: 8px 12px;
      background-color: #f3f4f6; /* gray-100 */
      font-size: 0.875rem;
      font-weight: 600;
      color: #4b5563;
      text-align: center;
      border: 1px solid #d1d5db;
      border-right: 2px solid #d1d5db;
      border-bottom: 2px solid #d1d5db;
      z-index: 10;
    }

    .td-modal {
      padding: 0;
      border: 1px solid #d1d5db;
      border-right: 2px solid #d1d5db;
      border-bottom: 1px solid #d1d5db;
      position: relative;
      background-color: white;
    }

    .modal-table-input {
      width: 100%;
      height: 100%;
      padding: 8px 12px;
      border: none;
      background-color: transparent;
      outline: none;
      font-size: 0.875rem;
      box-sizing: border-box;
      resize: none;
    }

    .modal-table-input:focus {
      background-color: #eff6ff; /* blue-50 */
      box-shadow: inset 0 0 0 2px #3b82f6;
    }

    .modal-table-input:read-only {
      background-color: #f9fafb;
      color: #6b7280;
      cursor: default;
    }

    .modal-table-input.highlight-required {
      background-color: #fef3c7; /* yellow-100 */
    }

    /* Drag and drop styles */
    .dragging {
      opacity: 0.5;
      background-color: #dbeafe !important;
    }

    .drag-over {
      border-top: 3px solid #3b82f6 !important;
    }

    .drag-handle {
      cursor: move;
      color: #9ca3af;
      padding: 4px;
    }

    .drag-handle:hover {
      color: #4b5563;
    }

    /* LOT dropdown styles */
    .lot-dropdown {
      position: absolute;
      background-color: white;
      border: 1px solid #d1d5db;
      border-radius: 0.375rem;
      margin-top: 2px;
      width: 400px;
      max-width: 90vw;
      z-index: 1000;
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
      max-height: 300px;
      overflow-y: auto;
    }

    .lot-dropdown-header {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr 1fr;
      gap: 1px;
      background-color: #f3f4f6;
      padding: 8px;
      font-weight: 600;
      font-size: 0.75rem;
      color: #4b5563;
      border-bottom: 1px solid #d1d5db;
    }

    .lot-dropdown-item {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr 1fr;
      gap: 1px;
      padding: 8px;
      cursor: pointer;
      border-bottom: 1px solid #e5e7eb;
      font-size: 0.875rem;
    }

    .lot-dropdown-item:hover {
      background-color: #eff6ff;
    }

    .lot-dropdown-item:last-child {
      border-bottom: none;
    }

    /* Status colors in LOT dropdown */
    .lot-status-het-date { color: #dc2626; font-weight: 500; }
    .lot-status-can-date { color: #f59e0b; font-weight: 500; }
    .lot-status-binh-thuong { color: #16a34a; font-weight: 500; }
    .lot-status-hang-hu { color: #1f2937; font-weight: 700; }

    /* Dark mode support for modal */
    .dark .th-modal {
      background-color: #374151;
      color: #e5e7eb;
      border-color: #4b5563;
    }

    .dark .td-modal {
      background-color: #1f2937;
      border-color: #4b5563;
    }

    .dark .modal-table-input {
      color: #e5e7eb;
    }

    .dark .modal-table-input:focus {
      background-color: #1e3a8a;
    }

    .dark .modal-table-input:read-only {
      background-color: #374151;
      color: #9ca3af;
    }

    .dark .lot-dropdown {
      background-color: #1f2937;
      border-color: #4b5563;
    }

    .dark .lot-dropdown-header {
      background-color: #374151;
      color: #e5e7eb;
      border-color: #4b5563;
    }

    .dark .lot-dropdown-item {
      color: #e5e7eb;
      border-color: #4b5563;
    }

    .dark .lot-dropdown-item:hover {
      background-color: #1e3a8a;
    }
  </style>
  <title>Ứng dụng Quản lý Kho</title>
</head>

<body class="bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-gray-100">
  <!-- Header -->
  <header class="bg-white dark:bg-gray-800 shadow-sm border-b border-gray-200 dark:border-gray-700 relative">
    <!-- Thanh tiến trình loading -->
    <div id="loading-progress-bar">
      <div id="loading-progress-bar-inner"></div>
    </div>
    
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex justify-between items-center py-4">
        <div class="flex items-center">
          <h1 class="text-2xl font-bold text-gray-900 dark:text-gray-100">Quản lý Kho</h1>
        </div>
        
        <!-- MỚI: Menu Cài đặt -->
        <div id="settings-menu" class="relative">
          <button id="settings-toggle-button" class="p-2 rounded-lg bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 transition">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
            </svg>
          </button>
          
          <!-- Popover Cài đặt -->
          <div id="settings-popover" class="hidden absolute right-0 mt-2 w-64 bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 z-50">
            <div class="p-4">
              <h3 class="text-lg font-semibold mb-3">Cài đặt</h3>
              
              <!-- Cỡ chữ -->
              <div class="mb-4">
                <label class="block text-sm font-medium mb-2">Cỡ chữ</label>
                <select id="font-size-select" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700">
                  <option value="75">Nhỏ (75%)</option>
                  <option value="100" selected>Bình thường (100%)</option>
                  <option value="125">Lớn (125%)</option>
                  <option value="150">Rất lớn (150%)</option>
                </select>
              </div>
              
              <!-- Chế độ tối -->
              <div class="flex items-center justify-between">
                <span class="text-sm font-medium">Chế độ tối</span>
                <button id="dark-mode-toggle" role="switch" aria-checked="false" class="relative inline-flex h-6 w-11 items-center rounded-full bg-gray-200 dark:bg-gray-600 transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
                  <span id="dark-mode-toggle-knob" class="inline-block h-4 w-4 transform rounded-full bg-white transition-transform translate-x-1 dark:translate-x-6"></span>
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </header>

  <!-- Navigation -->
  <nav class="bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex space-x-8">
        <a href="#" class="nav-link active" data-view="sanpham">Sản Phẩm</a>
        <a href="#" class="nav-link" data-view="tonkho">Tồn Kho</a>
        <a href="#" class="nav-link" data-view="donhang">Đơn Hàng</a>
        <a href="#" class="nav-link" data-view="chitiet">Chi Tiết</a>
      </div>
    </div>
  </nav>

  <!-- Toolbar -->
  <div class="bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 px-4 py-3">
    <div class="max-w-7xl mx-auto flex flex-wrap items-center gap-4">
      <!-- Tìm kiếm -->
      <div class="flex-1 min-w-64">
        <input type="text" id="toolbar-search" placeholder="Tìm kiếm..." 
               class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-gray-100">
      </div>

      <!-- Nút Hiện/Ẩn bộ lọc -->
      <button id="toolbar-toggle-filter" class="flex items-center px-4 py-2 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.207A1 1 0 013 6.5V4z" />
        </svg>
        <span id="toolbar-toggle-filter-text">Hiện bộ lọc</span>
      </button>

      <!-- Các nút hành động -->
      <div class="flex items-center gap-2">
        <button id="toolbar-clear-filter" class="flex items-center px-4 py-2 bg-yellow-100 dark:bg-yellow-900 text-yellow-800 dark:text-yellow-200 rounded-lg hover:bg-yellow-200 dark:hover:bg-yellow-800 transition">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
          </svg>
          Xóa bộ lọc
        </button>

        <button id="toolbar-add" class="flex items-center px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
          </svg>
          Thêm
        </button>

        <button id="toolbar-edit" class="flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition" disabled>
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
          </svg>
          Sửa
        </button>

        <button id="toolbar-delete" class="flex items-center px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition" disabled>
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
          </svg>
          Xóa
        </button>

        <!-- Nút Lưu và Hủy (ẩn mặc định) -->
        <button id="toolbar-save" class="flex items-center px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition" hidden>
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
          </svg>
          Lưu
        </button>

        <button id="toolbar-cancel" class="flex items-center px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition" hidden>
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
          </svg>
          Hủy
        </button>

        <button id="toolbar-excel" class="flex items-center px-4 py-2 bg-emerald-600 text-white rounded-lg hover:bg-emerald-700 transition">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
          </svg>
          Tải Excel
        </button>

        <button id="toolbar-sync" class="flex items-center px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
          </svg>
          Đồng bộ
        </button>
      </div>
    </div>
  </div>

  <!-- MỚI: Bộ lọc (ẩn mặc định) -->
  <div id="filter-panel" class="bg-gray-50 dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 px-4 py-3 hidden">
    <div class="max-w-7xl mx-auto">
      
      <!-- Bộ lọc cho Sản Phẩm -->
      <div id="filter-sanpham" class="filter-view-options hidden">
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
          <div class="custom-filter" data-filter-column="ma_vt">
            <button class="custom-filter-toggle">
              <span class="custom-filter-text">Tất cả</span>
              <svg class="custom-filter-arrow" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
              </svg>
            </button>
            <div class="custom-filter-panel hidden">
              <input type="text" class="custom-filter-search" placeholder="Tìm Mã VT...">
              <div class="custom-filter-list"></div>
              <button class="custom-filter-apply mt-2 w-full px-3 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">Áp dụng</button>
            </div>
          </div>

          <div class="custom-filter" data-filter-column="ten_vt">
            <button class="custom-filter-toggle">
              <span class="custom-filter-text">Tất cả</span>
              <svg class="custom-filter-arrow" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
              </svg>
            </button>
            <div class="custom-filter-panel hidden">
              <input type="text" class="custom-filter-search" placeholder="Tìm Tên VT...">
              <div class="custom-filter-list"></div>
              <button class="custom-filter-apply mt-2 w-full px-3 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">Áp dụng</button>
            </div>
          </div>

          <div class="custom-filter" data-filter-column="nganh">
            <button class="custom-filter-toggle">
              <span class="custom-filter-text">Tất cả</span>
              <svg class="custom-filter-arrow" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
              </svg>
            </button>
            <div class="custom-filter-panel hidden">
              <input type="text" class="custom-filter-search" placeholder="Tìm Ngành...">
              <div class="custom-filter-list"></div>
              <button class="custom-filter-apply mt-2 w-full px-3 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">Áp dụng</button>
            </div>
          </div>

          <div class="custom-filter" data-filter-column="phu_trach">
            <button class="custom-filter-toggle">
              <span class="custom-filter-text">Tất cả</span>
              <svg class="custom-filter-arrow" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
              </svg>
            </button>
            <div class="custom-filter-panel hidden">
              <input type="text" class="custom-filter-search" placeholder="Tìm Phụ trách...">
              <div class="custom-filter-list"></div>
              <button class="custom-filter-apply mt-2 w-full px-3 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">Áp dụng</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Bộ lọc cho Tồn Kho -->
      <div id="filter-tonkho" class="filter-view-options hidden">
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-6 gap-4">
          <div class="custom-filter" data-filter-column="ma_vt">
            <button class="custom-filter-toggle">
              <span class="custom-filter-text">Tất cả</span>
              <svg class="custom-filter-arrow" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
              </svg>
            </button>
            <div class="custom-filter-panel hidden">
              <input type="text" class="custom-filter-search" placeholder="Tìm Mã VT...">
              <div class="custom-filter-list"></div>
              <button class="custom-filter-apply mt-2 w-full px-3 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">Áp dụng</button>
            </div>
          </div>

          <div class="custom-filter" data-filter-column="lot">
            <button class="custom-filter-toggle">
              <span class="custom-filter-text">Tất cả</span>
              <svg class="custom-filter-arrow" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
              </svg>
            </button>
            <div class="custom-filter-panel hidden">
              <input type="text" class="custom-filter-search" placeholder="Tìm LOT...">
              <div class="custom-filter-list"></div>
              <button class="custom-filter-apply mt-2 w-full px-3 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">Áp dụng</button>
            </div>
          </div>

          <div class="custom-filter" data-filter-column="ton_cuoi">
            <button class="custom-filter-toggle">
              <span class="custom-filter-text">Tất cả</span>
              <svg class="custom-filter-arrow" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
              </svg>
            </button>
            <div class="custom-filter-panel hidden">
              <div class="custom-filter-list"></div>
              <button class="custom-filter-apply mt-2 w-full px-3 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">Áp dụng</button>
            </div>
          </div>

          <div class="custom-filter" data-filter-column="tinh_trang">
            <button class="custom-filter-toggle">
              <span class="custom-filter-text">Tất cả</span>
              <svg class="custom-filter-arrow" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
              </svg>
            </button>
            <div class="custom-filter-panel hidden">
              <input type="text" class="custom-filter-search" placeholder="Tìm Tình trạng...">
              <div class="custom-filter-list"></div>
              <button class="custom-filter-apply mt-2 w-full px-3 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">Áp dụng</button>
            </div>
          </div>

          <div class="custom-filter" data-filter-column="nganh">
            <button class="custom-filter-toggle">
              <span class="custom-filter-text">Tất cả</span>
              <svg class="custom-filter-arrow" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
              </svg>
            </button>
            <div class="custom-filter-panel hidden">
              <input type="text" class="custom-filter-search" placeholder="Tìm Ngành...">
              <div class="custom-filter-list"></div>
              <button class="custom-filter-apply mt-2 w-full px-3 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">Áp dụng</button>
            </div>
          </div>

          <div class="custom-filter" data-filter-column="phu_trach">
            <button class="custom-filter-toggle">
              <span class="custom-filter-text">Tất cả</span>
              <svg class="custom-filter-arrow" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
              </svg>
            </button>
            <div class="custom-filter-panel hidden">
              <input type="text" class="custom-filter-search" placeholder="Tìm Phụ trách...">
              <div class="custom-filter-list"></div>
              <button class="custom-filter-apply mt-2 w-full px-3 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">Áp dụng</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Bộ lọc cho Đơn Hàng -->
      <div id="filter-donhang" class="filter-view-options hidden">
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-6 gap-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Từ ngày</label>
            <input type="date" name="thoi_gian_from" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700">
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Đến ngày</label>
            <input type="date" name="thoi_gian_to" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700">
          </div>

          <div class="custom-filter" data-filter-column="ma_kho">
            <button class="custom-filter-toggle">
              <span class="custom-filter-text">Tất cả</span>
              <svg class="custom-filter-arrow" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
              </svg>
            </button>
            <div class="custom-filter-panel hidden">
              <input type="text" class="custom-filter-search" placeholder="Tìm Mã kho...">
              <div class="custom-filter-list"></div>
              <button class="custom-filter-apply mt-2 w-full px-3 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">Áp dụng</button>
            </div>
          </div>

          <div class="custom-filter" data-filter-column="ma_nx">
            <button class="custom-filter-toggle">
              <span class="custom-filter-text">Tất cả</span>
              <svg class="custom-filter-arrow" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
              </svg>
            </button>
            <div class="custom-filter-panel hidden">
              <input type="text" class="custom-filter-search" placeholder="Tìm Mã NX...">
              <div class="custom-filter-list"></div>
              <button class="custom-filter-apply mt-2 w-full px-3 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">Áp dụng</button>
            </div>
          </div>

          <div class="custom-filter" data-filter-column="loai_don">
            <button class="custom-filter-toggle">
              <span class="custom-filter-text">Tất cả</span>
              <svg class="custom-filter-arrow" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
              </svg>
            </button>
            <div class="custom-filter-panel hidden">
              <div class="custom-filter-list"></div>
              <button class="custom-filter-apply mt-2 w-full px-3 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">Áp dụng</button>
            </div>
          </div>

          <div class="custom-filter" data-filter-column="trang_thai">
            <button class="custom-filter-toggle">
              <span class="custom-filter-text">Tất cả</span>
              <svg class="custom-filter-arrow" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
              </svg>
            </button>
            <div class="custom-filter-panel hidden">
              <div class="custom-filter-list"></div>
              <button class="custom-filter-apply mt-2 w-full px-3 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">Áp dụng</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Bộ lọc cho Chi Tiết -->
      <div id="filter-chitiet" class="filter-view-options hidden">
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4 mb-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Từ ngày</label>
            <input type="date" name="thoi_gian_from" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700">
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Đến ngày</label>
            <input type="date" name="thoi_gian_to" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700">
          </div>

          <div class="custom-filter" data-filter-column="ma_kho">
            <button class="custom-filter-toggle">
              <span class="custom-filter-text">Tất cả</span>
              <svg class="custom-filter-arrow" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
              </svg>
            </button>
            <div class="custom-filter-panel hidden">
              <input type="text" class="custom-filter-search" placeholder="Tìm Mã kho...">
              <div class="custom-filter-list"></div>
              <button class="custom-filter-apply mt-2 w-full px-3 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">Áp dụng</button>
            </div>
          </div>

          <div class="custom-filter" data-filter-column="ma_nx">
            <button class="custom-filter-toggle">
              <span class="custom-filter-text">Tất cả</span>
              <svg class="custom-filter-arrow" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
              </svg>
            </button>
            <div class="custom-filter-panel hidden">
              <input type="text" class="custom-filter-search" placeholder="Tìm Mã NX...">
              <div class="custom-filter-list"></div>
              <button class="custom-filter-apply mt-2 w-full px-3 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">Áp dụng</button>
            </div>
          </div>

          <div class="custom-filter" data-filter-column="loai_don">
            <button class="custom-filter-toggle">
              <span class="custom-filter-text">Tất cả</span>
              <svg class="custom-filter-arrow" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
              </svg>
            </button>
            <div class="custom-filter-panel hidden">
              <div class="custom-filter-list"></div>
              <button class="custom-filter-apply mt-2 w-full px-3 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">Áp dụng</button>
            </div>
          </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4">
          <div class="custom-filter" data-filter-column="ma_vt">
            <button class="custom-filter-toggle">
              <span class="custom-filter-text">Tất cả</span>
              <svg class="custom-filter-arrow" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
              </svg>
            </button>
            <div class="custom-filter-panel hidden">
              <input type="text" class="custom-filter-search" placeholder="Tìm Mã VT...">
              <div class="custom-filter-list"></div>
              <button class="custom-filter-apply mt-2 w-full px-3 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">Áp dụng</button>
            </div>
          </div>

          <div class="custom-filter" data-filter-column="lot">
            <button class="custom-filter-toggle">
              <span class="custom-filter-text">Tất cả</span>
              <svg class="custom-filter-arrow" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
              </svg>
            </button>
            <div class="custom-filter-panel hidden">
              <input type="text" class="custom-filter-search" placeholder="Tìm LOT...">
              <div class="custom-filter-list"></div>
              <button class="custom-filter-apply mt-2 w-full px-3 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">Áp dụng</button>
            </div>
          </div>

          <div class="custom-filter" data-filter-column="nganh">
            <button class="custom-filter-toggle">
              <span class="custom-filter-text">Tất cả</span>
              <svg class="custom-filter-arrow" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
              </svg>
            </button>
            <div class="custom-filter-panel hidden">
              <input type="text" class="custom-filter-search" placeholder="Tìm Ngành...">
              <div class="custom-filter-list"></div>
              <button class="custom-filter-apply mt-2 w-full px-3 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">Áp dụng</button>
            </div>
          </div>

          <div class="custom-filter" data-filter-column="phu_trach">
            <button class="custom-filter-toggle">
              <span class="custom-filter-text">Tất cả</span>
              <svg class="custom-filter-arrow" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
              </svg>
            </button>
            <div class="custom-filter-panel hidden">
              <input type="text" class="custom-filter-search" placeholder="Tìm Phụ trách...">
              <div class="custom-filter-list"></div>
              <button class="custom-filter-apply mt-2 w-full px-3 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">Áp dụng</button>
            </div>
          </div>

          <div class="custom-filter" data-filter-column="trang_thai">
            <button class="custom-filter-toggle">
              <span class="custom-filter-text">Tất cả</span>
              <svg class="custom-filter-arrow" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
              </svg>
            </button>
            <div class="custom-filter-panel hidden">
              <div class="custom-filter-list"></div>
              <button class="custom-filter-apply mt-2 w-full px-3 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">Áp dụng</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Main Content -->
  <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
    <!-- View: Sản Phẩm -->
    <div id="view-sanpham" class="view active">
      <div class="bg-white dark:bg-gray-800 shadow-sm rounded-lg overflow-hidden">
        <div class="overflow-x-auto">
          <table class="min-w-full">
            <thead>
              <tr>
                <th class="th w-12">
                  <input type="checkbox" class="select-all-checkbox" data-view="sanpham">
                </th>
                <th class="th">Mã VT</th>
                <th class="th">Tên VT</th>
                <th class="th">Ngành</th>
                <th class="th">Phụ trách</th>
              </tr>
            </thead>
            <tbody id="sanpham-table-body" class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
              <!-- Dữ liệu sẽ được tải bằng JavaScript -->
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- View: Tồn Kho -->
    <div id="view-tonkho" class="view">
      <div class="bg-white dark:bg-gray-800 shadow-sm rounded-lg overflow-hidden">
        <div class="overflow-x-auto">
          <table class="min-w-full">
            <thead>
              <tr>
                <th class="th w-12">
                  <input type="checkbox" class="select-all-checkbox" data-view="tonkho">
                </th>
                <th class="th">Mã vạch</th>
                <th class="th">Mã VT</th>
                <th class="th">Tên VT</th>
                <th class="th">LOT</th>
                <th class="th">Date</th>
                <th class="th">Tồn đầu</th>
                <th class="th">Nhập</th>
                <th class="th">Xuất</th>
                <th class="th">Tồn cuối</th>
                <th class="th">Tình trạng</th>
                <th class="th">Tray</th>
                <th class="th">Ngành</th>
                <th class="th">Phụ trách</th>
              </tr>
            </thead>
            <tbody id="tonkho-table-body" class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
              <!-- Dữ liệu sẽ được tải bằng JavaScript -->
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- View: Đơn Hàng -->
    <div id="view-donhang" class="view">
      <div class="bg-white dark:bg-gray-800 shadow-sm rounded-lg overflow-hidden">
        <div class="overflow-x-auto">
          <table class="min-w-full">
            <thead>
              <tr>
                <th class="th w-12">
                  <input type="checkbox" class="select-all-checkbox" data-view="donhang">
                </th>
                <th class="th">Mã kho</th>
                <th class="th">Thời gian</th>
                <th class="th">Mã NX</th>
                <th class="th">User</th>
                <th class="th">Ngành</th>
                <th class="th">Mục đích</th>
                <th class="th">Địa chỉ</th>
                <th class="th">Ghi chú</th>
                <th class="th">Order</th>
                <th class="th">PKL</th>
                <th class="th">Done</th>
                <th class="th">Image</th>
              </tr>
            </thead>
            <tbody id="donhang-table-body" class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
              <!-- Dữ liệu sẽ được tải bằng JavaScript -->
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- View: Chi Tiết -->
    <div id="view-chitiet" class="view">
      <div class="bg-white dark:bg-gray-800 shadow-sm rounded-lg overflow-hidden">
        <div class="overflow-x-auto">
          <table class="min-w-full">
            <thead>
              <tr>
                <th class="th w-12">
                  <input type="checkbox" class="select-all-checkbox" data-view="chitiet">
                </th>
                <th class="th">ID</th>
                <th class="th">Thời gian</th>
                <th class="th">Mã kho</th>
                <th class="th">Mã NX</th>
                <th class="th">Mã vạch</th>
                <th class="th">Mã VT</th>
                <th class="th">Tên VT</th>
                <th class="th">LOT</th>
                <th class="th">Date</th>
                <th class="th">Yêu cầu</th>
                <th class="th">Số lượng</th>
                <th class="th">Loại</th>
                <th class="th">User</th>
                <th class="th">Mục đích</th>
                <th class="th">Ngành</th>
                <th class="th">Phụ trách</th>
              </tr>
            </thead>
            <tbody id="chitiet-table-body" class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
              <!-- Dữ liệu sẽ được tải bằng JavaScript -->
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </main>

  <!-- Footer với phân trang và thông tin đồng bộ -->
  <footer class="bg-white dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700 px-4 py-3">
    <div class="max-w-7xl mx-auto flex flex-wrap items-center justify-between gap-4">
      <!-- Phân trang -->
      <div class="flex items-center gap-4">
        <div class="flex items-center gap-2">
          <label class="text-sm text-gray-600 dark:text-gray-400">Hiển thị:</label>
          <select id="pagination-limit" class="px-2 py-1 border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700 text-sm">
            <option value="25">25</option>
            <option value="50" selected>50</option>
            <option value="100">100</option>
            <option value="200">200</option>
          </select>
        </div>

        <div class="flex items-center gap-2">
          <button id="pagination-prev" class="px-3 py-1 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded hover:bg-gray-300 dark:hover:bg-gray-600 disabled:opacity-50 disabled:cursor-not-allowed">
            ‹ Trước
          </button>
          
          <div class="flex items-center gap-1">
            <span class="text-sm text-gray-600 dark:text-gray-400">Trang</span>
            <input type="number" id="pagination-page" min="1" value="1" class="w-16 px-2 py-1 border border-gray-300 dark:border-gray-600 rounded text-center text-sm bg-white dark:bg-gray-700">
            <span class="text-sm text-gray-600 dark:text-gray-400">/ <span id="pagination-total-pages">1</span></span>
          </div>
          
          <button id="pagination-next" class="px-3 py-1 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded hover:bg-gray-300 dark:hover:bg-gray-600 disabled:opacity-50 disabled:cursor-not-allowed">
            Tiếp ›
          </button>
        </div>

        <div class="text-sm text-gray-600 dark:text-gray-400">
          <span id="pagination-info">Hiển thị 1-50 của 0</span>
        </div>
      </div>

      <!-- Thông tin đồng bộ -->
      <div class="text-sm text-gray-500 dark:text-gray-400">
        <span id="last-sync-time">Chưa đồng bộ</span>
      </div>
    </div>
  </footer>

  <!-- Modal Xác nhận -->
  <div id="confirm-modal" class="fixed inset-0 bg-gray-600 bg-opacity-75 overflow-y-auto h-full w-full hidden z-50 flex items-center justify-center">
    <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-xl max-w-md w-full mx-4">
      <div class="flex items-center justify-between mb-4">
        <h3 class="text-lg font-semibold text-gray-900 dark:text-gray-100">Xác nhận</h3>
      </div>
      <p id="confirm-message" class="text-gray-600 dark:text-gray-300 mb-6"></p>
      <div class="flex justify-end gap-3">
        <button id="confirm-cancel" class="px-4 py-2 bg-gray-200 dark:bg-gray-600 text-gray-800 dark:text-gray-200 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-500 transition">Hủy</button>
        <button id="confirm-ok" class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition">Xóa</button>
      </div>
    </div>
  </div>

  <!-- ENHANCED: Modal Đơn Hàng -->
  <div id="donhang-modal" class="fixed inset-0 bg-gray-600 bg-opacity-75 overflow-y-auto h-full w-full hidden z-40 flex items-center justify-center">
    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-7xl mx-4 max-h-[95vh] overflow-hidden">
      <!-- Header -->
      <div class="flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700">
        <h3 id="donhang-modal-title" class="text-xl font-semibold text-gray-900 dark:text-gray-100">Tạo Đơn Hàng Mới</h3>
        <button id="donhang-modal-close" class="text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm p-1.5 ml-auto inline-flex items-center dark:hover:bg-gray-600 dark:hover:text-white">
          <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
          </svg>
        </button>
      </div>

      <!-- Content -->
      <div class="p-6 overflow-y-auto max-h-[calc(95vh-140px)]">
        <form id="donhang-form">
          <!-- Thông tin đơn hàng -->
          <div class="section-title">Thông tin đơn hàng</div>
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
            <div>
              <label class="form-label">Thời gian*</label>
              <input type="date" id="dh-thoi-gian" name="thoi_gian" class="form-input" required>
            </div>
            <div>
              <label class="form-label">Loại đơn*</label>
              <select id="dh-loai-don" name="loai_don" class="form-input" required>
                <option value="">-- Chọn --</option>
                <option value="Nhập">Nhập</option>
                <option value="Xuất">Xuất</option>
              </select>
            </div>
            <div>
              <label class="form-label">Mã kho*</label>
              <input type="text" id="dh-ma-kho" name="ma_kho" class="form-input" value="OUT.JNJ643205" required>
            </div>
            <div>
              <label id="dh-ma-nx-label" class="form-label">Mã Nhập/Xuất*</label>
              <input type="text" id="dh-ma-nx" name="ma_nx" class="form-input" required>
            </div>
          </div>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
            <div>
              <label id="dh-user-label" class="form-label">Nhập từ/Xuất cho*</label>
              <input type="text" id="dh-user" name="user" class="form-input" required>
            </div>
            <div>
              <label class="form-label">Ngành hàng</label>
              <input type="text" id="dh-nganh" name="nganh" class="form-input" list="nganh-datalist">
              <datalist id="nganh-datalist"></datalist>
            </div>
          </div>

          <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
            <div>
              <label class="form-label">Mục đích</label>
              <textarea name="muc_dich" rows="2" class="form-textarea"></textarea>
            </div>
            <div>
              <label class="form-label">Địa chỉ</label>
              <textarea name="dia_chi" rows="2" class="form-textarea"></textarea>
            </div>
            <div>
              <label class="form-label">Ghi chú</label>
              <textarea name="ghi_chu" rows="2" class="form-textarea"></textarea>
            </div>
          </div>

          <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
            <div>
              <label class="form-label">Order</label>
              <input type="text" name="order" class="form-input">
            </div>
            <div>
              <label class="form-label">PKL</label>
              <input type="text" name="pkl" class="form-input">
            </div>
            <div>
              <label class="form-label">Done</label>
              <input type="text" name="done" class="form-input">
            </div>
            <div>
              <label class="form-label">Image</label>
              <input type="text" name="image" class="form-input">
            </div>
          </div>

          <!-- Danh sách sản phẩm -->
          <div class="section-title">
            Danh sách sản phẩm 
            <span class="text-sm font-normal text-gray-500">
              (Tổng: <span id="dh-total-quantity" class="font-semibold">0</span>)
            </span>
          </div>
          
          <div class="overflow-x-auto border border-gray-300 dark:border-gray-600 rounded-lg mb-4">
            <table id="donhang-modal-details-table" class="w-full">
              <colgroup>
                <col style="width: 4%;">   <!-- STT -->
                <col style="width: 12%;">  <!-- Mã VT -->
                <col style="width: 20%;">  <!-- Tên VT -->
                <col style="width: 12%;">  <!-- LOT -->
                <col style="width: 10%;">  <!-- Date -->
                <col style="width: 8%;">   <!-- Yêu cầu -->
                <col style="width: 8%;" id="dh-quantity-header">   <!-- Số lượng -->
                <col style="width: 8%;" id="dh-remaining-stock-header">   <!-- Tồn sau -->
                <col style="width: 12%;">  <!-- Mã vạch -->
                <col style="width: 10%;">  <!-- Loại -->
                <col style="width: 4%;">   <!-- Xóa -->
              </colgroup>
              <thead>
                <tr>
                  <th class="th-modal">
                    <div class="drag-handle">⋮⋮</div>
                  </th>
                  <th class="th-modal">Mã VT*</th>
                  <th class="th-modal">Tên VT</th>
                  <th class="th-modal">LOT*</th>
                  <th class="th-modal">Date</th>
                  <th class="th-modal">Yêu cầu</th>
                  <th class="th-modal">Số lượng*</th>
                  <th class="th-modal dh-ton-sau-xuat-cell">Tồn sau</th>
                  <th class="th-modal">Mã vạch</th>
                  <th class="th-modal">Loại</th>
                  <th class="th-modal">Xóa</th>
                </tr>
              </thead>
              <tbody id="donhang-modal-details-body">
                <!-- Rows will be added dynamically -->
              </tbody>
            </table>
          </div>

          <button type="button" id="dh-add-detail-row" class="w-full px-4 py-2 bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 rounded-lg hover:bg-blue-200 dark:hover:bg-blue-800 transition flex items-center justify-center gap-2">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
            </svg>
            Thêm sản phẩm
          </button>
        </form>
      </div>

      <!-- Footer -->
      <div class="flex justify-end gap-3 p-6 border-t border-gray-200 dark:border-gray-700">
        <button id="donhang-modal-cancel" class="px-6 py-2 bg-gray-200 dark:bg-gray-600 text-gray-800 dark:text-gray-200 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-500 transition">Hủy</button>
        <button id="donhang-modal-save" class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition">Lưu Đơn Hàng</button>
      </div>
    </div>
  </div>

  <!-- Toast Container -->
  <div id="toast-container" class="fixed top-4 right-4 z-50 space-y-2"></div>

  <!-- JavaScript -->
  <script src="app.js"></script>
</body>

</html>