
<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Quản Lí Vật Tư</title>
    <link rel="icon" type="image/png" href="https://images.seeklogo.com/logo-png/50/1/johnson-johnson-logo-png_seeklogo-500414.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>
    <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <style>
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .modal-backdrop { background-color: rgba(0, 0, 0, 0.5); }
        .nav-button.active { background-color: #374151; color: #f3f4f6; }
        .mobile-nav-btn.active { color: #60a5fa; } 
        
        button, .nav-button, .cursor-pointer {
            transition: all 0.2s ease-in-out;
        }
        button:not(:disabled):active, .nav-button:active {
            transform: scale(0.97);
        }
        button:disabled { opacity: 0.5; cursor: not-allowed; }
        
        .table-container { 
            flex: 1;
            min-height: 0;
            overflow-y: auto; 
            position: relative; 
        }
        
        @media (min-width: 768px) {
            .table-container { height: calc(100vh - 200px); }
        }
        
        @media (max-width: 768px) {
            body { font-size: 10px; } 
            
            th, td { padding: 4px 4px !important; }
            input, select, button { font-size: 10px !important; }
            
            .modal-content-custom {
                padding: 1rem !important;
                max-width: 95vw !important;
            }
            .modal-header-custom {
                padding: 0.75rem 1rem !important;
            }
            h3.text-lg { font-size: 1rem !important; }

            .sticky-header th {
                position: sticky !important;
                top: 0 !important;
                z-index: 30 !important;
                background-color: #e5e7eb !important;
                box-shadow: 0 1px 2px rgba(0,0,0,0.1);
            }

            #main-header {
                height: 40px !important;
                padding: 0 8px !important;
            }
            #view-title {
                font-size: 12px !important;
            }
            #notification-bar {
                max-width: 70% !important;
                font-size: 9px !important;
            }

            .mobile-summary-container {
                display: flex;
                justify-content: flex-end;
                overflow-x: auto;
                width: 100%;
                -webkit-overflow-scrolling: touch;
            }
            .mobile-summary-content {
                display: flex;
                flex-shrink: 0;
                white-space: nowrap;
                min-width: min-content;
            }
            
            .filter-active-mobile {
                background-color: #dbeafe !important;
                color: #2563eb !important;
                border: 1px solid #bfdbfe !important;
            }

            .filter-popover {
                min-width: 180px !important;
                padding: 6px !important;
            }
            .filter-popover .filter-search-input {
                font-size: 10px !important;
                padding: 4px 8px !important;
                margin-bottom: 4px !important;
            }
            .filter-popover .filter-options-list {
                max-height: 160px !important;
            }
            .filter-popover label {
                padding: 3px 6px !important;
            }
            .filter-popover label span {
                font-size: 10px !important;
            }
            .filter-popover input[type="checkbox"] {
                width: 12px;
                height: 12px;
            }
            .filter-popover .filter-apply-btn {
                font-size: 10px !important;
                padding: 2px 8px !important;
            }

            .sticky-action-col-mobile {
                position: sticky !important;
                right: 0 !important;
                background-color: white !important;
                z-index: 25 !important;
                box-shadow: -2px 0 4px rgba(0,0,0,0.1);
            }
            th.sticky-action-col-mobile {
                background-color: #e5e7eb !important;
                z-index: 35 !important;
            }
            
            /* Hierarchy Mobile Adjustments */
            .tree-children { padding-left: 12px !important; }
            .tree-node-content { padding: 4px 6px !important; }

            /* Mobile Chat Panel Adjustment - Nâng cao lên 140px để tránh che bộ đếm */
            #voice-chat-panel {
                bottom: 140px !important;
            }
        }

        #toast-container {
            position: fixed;
            top: 1.5rem;
            right: 1.5rem;
            z-index: 9999;
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }
        .toast {
            display: flex;
            align-items: center;
            padding: 1rem;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            color: white;
            opacity: 0;
            transform: translateX(100%);
            transition: all 0.3s ease-in-out;
        }
        .toast.show { opacity: 1; transform: translateX(0); }
        .toast.hide { opacity: 0; transform: translateX(100%); }
        .toast-success { background-color: #28a745; }
        .toast-error { background-color: #dc3545; }
        .toast-info { background-color: #17a2b8; }

        .filter-popover {
            position: absolute;
            z-index: 999; 
            background: white;
            border: 1px solid #ccc;
            border-radius: 6px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 8px;
            min-width: 250px;
        }
        .filter-options-list {
            max-height: 200px;
            overflow-y: auto;
        }
        
        @keyframes loading-bar-flow {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        .animate-loading-bar-flow {
            width: 100%;
            position: absolute;
            animation: loading-bar-flow 1.5s infinite linear;
        }
        #loading-bar {
            background-color: #93c5fd; 
            overflow: hidden;
        }

        .sticky-header th {
            position: sticky;
            top: 0;
            z-index: 20;
            background-color: #e5e7eb;
        }

        .action-popover {
            position: absolute;
            z-index: 999;
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 0.75rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            min-width: 140px;
            overflow: hidden;
        }
        .action-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1rem;
            width: 100%;
            text-align: left;
            font-size: 0.875rem;
            color: #374151;
            transition: background 0.2s;
        }
        .action-item:hover {
            background-color: #f3f4f6;
        }

        /* Hierarchy Styles */
        .tree-node-content { cursor: pointer; display: flex; align-items: center; gap: 8px; padding: 6px 10px; border-radius: 6px; transition: background 0.2s; }
        .tree-node-content:hover { background-color: #f3f4f6; }
        .tree-toggle-icon { transition: transform 0.3s; flex-shrink: 0; }
        .tree-node.expanded > .tree-node-content > .tree-toggle-icon { transform: rotate(90deg); }
        .tree-children { display: none; padding-left: 20px; border-left: 1px dashed #e5e7eb; margin-left: 10px; }
        .tree-node.expanded > .tree-children { display: block; }

        /* Voice Assistant Styles */
        .voice-pulse {
            animation: pulse-ring 1.5s cubic-bezier(0.24, 0, 0.38, 1) infinite;
        }
        @keyframes pulse-ring {
            0% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.7); }
            70% { transform: scale(1); box-shadow: 0 0 0 10px rgba(59, 130, 246, 0); }
            100% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.7); }
        }

        .draggable-handle {
            cursor: move;
        }
    </style>
<script type="importmap">
{
  "imports": {
    "@google/genai": "https://esm.sh/@google/genai@^1.34.0"
  }
}
</script>
</head>
<body class="bg-gray-100 font-sans antialiased text-[10px] md:text-sm">

    <div id="loading-bar" class="fixed top-0 left-0 right-0 h-1 z-[9999] hidden">
        <div class="h-full bg-blue-500 animate-loading-bar-flow"></div>
    </div>

    <div id="toast-container"></div>

    <!-- Voice Chat Control Panel -->
    <div id="voice-chat-panel" class="hidden fixed bottom-24 right-4 md:right-8 z-50 w-72 md:w-80 bg-white rounded-2xl shadow-2xl border border-blue-100 overflow-hidden animate-in slide-in-from-bottom-4 duration-300">
        <div id="voice-chat-header" class="p-4 bg-blue-600 text-white flex justify-between items-center draggable-handle">
            <div class="flex items-center gap-2 pointer-events-none">
                <div id="voice-pulse-ring" class="w-2.5 h-2.5 rounded-full bg-green-400"></div>
                <span class="text-xs font-bold uppercase tracking-widest">Tra cứu tồn</span>
            </div>
            <div class="flex items-center gap-1">
                <button id="open-voice-settings-btn" class="hover:bg-blue-50 p-1.5 rounded-lg transition-colors" title="Cài đặt API Key">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 0 0 2.573 1.066c1.543.94 3.31.826 2.37 2.37a1.724 1.724 0 0 0 1.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 0 0-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 0 0-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 0 0-2.573-1.066-1.543-.94-3.31-.826-2.37-2.37a1.724 1.724 0 0 0-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 0 0 1.066-2.573c-.94-1.543.826 3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path></svg>
                </button>
                <button id="close-voice-chat-btn" class="hover:bg-blue-50 p-1 rounded-full text-xl leading-none">&times;</button>
            </div>
        </div>
        <div id="voice-scroll-container" class="p-4 h-56 overflow-y-auto bg-gray-50 flex flex-col justify-start">
            <div id="voice-status-text" class="text-blue-600 font-bold mb-2 text-center sticky top-0 bg-gray-50 py-1 z-10 border-b border-blue-50">Đang khởi tạo...</div>
            <div id="voice-transcript-text" class="text-[10px] md:text-xs text-gray-500 italic px-2 space-y-4"></div>
        </div>
        <div class="p-3 bg-white border-t border-gray-100 flex justify-center">
            <div class="flex items-center gap-4 text-[10px] text-gray-400 font-medium">
                <span>Micro đang bật</span>
                <div class="flex gap-0.5">
                    <div class="w-0.5 h-3 bg-blue-400 animate-bounce" style="animation-delay: 0.1s"></div>
                    <div class="w-0.5 h-4 bg-blue-500 animate-bounce" style="animation-delay: 0.2s"></div>
                    <div class="w-0.5 h-2 bg-blue-400 animate-bounce" style="animation-delay: 0.3s"></div>
                </div>
            </div>
        </div>
    </div>

    <div id="app-loading" class="flex items-center justify-center h-[100dvh]">
        <div class="text-center">
            <svg class="animate-spin h-10 w-10 text-blue-500 mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
            <p class="mt-2 text-gray-600">Đang tải ứng dụng...</p>
        </div>
    </div>

    <div id="main-app" class="hidden">
        <div class="flex h-[100dvh] bg-gray-200 overflow-hidden">
            <div id="sidebar" class="hidden md:flex fixed inset-y-0 left-0 z-30 w-64 transform transition-all duration-300 ease-in-out bg-gray-900 text-gray-200 no-scrollbar overflow-y-auto flex-col">
                <div id="sidebar-header-content" class="flex items-center justify-between p-4 border-b border-gray-700 flex-shrink-0">
                     <div id="user-details" class="flex items-center gap-3">
                        <div class="relative flex-shrink-0">
                            <img id="sidebar-avatar" src="" alt="Avatar" class="w-10 h-10 rounded-full object-cover">
                            <span id="sidebar-avatar-status" class="absolute -bottom-0.5 -right-0.5 block h-3 w-3 rounded-full bg-gray-400 ring-2 ring-gray-900"></span>
                        </div>
                        <div id="user-info-text">
                            <span class="font-semibold text-base" id="user-ho-ten">Đang tải...</span>
                            <span class="text-xs text-gray-400 block" id="user-gmail">...</span>
                        </div>
                    </div>
                    <button id="sidebar-toggle-btn" class="p-2 rounded-full hover:bg-gray-700">
                        <svg id="sidebar-toggle-icon-close" class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 19l-7-7 7-7m8 14l-7-7 7-7"></path></svg>
                        <svg id="sidebar-toggle-icon-open" class="w-6 h-6 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 5l7 7-7 7M5 5l7 7-7 7"></path></svg>
                    </button>
                </div>

                <nav class="mt-4 flex-grow">
                    <button data-view="view-phat-trien" class="nav-button w-full flex items-center px-6 py-3 text-gray-400 hover:bg-gray-700 active">
                        <svg class="w-6 h-6 mr-4 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6z"></path></svg>
                        <span class="nav-text transition-opacity duration-300">Tổng Quan</span>
                    </button>
                    <button data-view="view-san-pham" class="nav-button w-full flex items-center px-6 py-3 text-gray-400 hover:bg-gray-700">
                        <svg class="w-6 h-6 mr-4 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 v2M7 7h10"></path></svg>
                        <span class="nav-text transition-opacity duration-300">Sản Phẩm</span>
                    </button>
                    <button data-view="view-ton-kho" class="nav-button w-full flex items-center px-6 py-3 text-gray-400 hover:bg-gray-700">
                        <svg class="w-6 h-6 mr-4 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4"></path></svg>
                        <span class="nav-text transition-opacity duration-300">Tồn Kho</span>
                    </button>
                    <button data-view="view-chi-tiet" class="nav-button w-full flex items-center px-6 py-3 text-gray-400 hover:bg-gray-700">
                        <svg class="w-6 h-6 mr-4 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>
                        <span class="nav-text transition-opacity duration-300">Chi Tiết</span>
                    </button>
                    <button data-view="view-cai-dat" class="nav-button w-full flex items-center px-6 py-3 text-gray-400 hover:bg-gray-700">
                         <svg class="w-6 h-6 mr-4 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 0 0 2.573 1.066c1.543.94 3.31.826 2.37 2.37a1.724 1.724 0 0 0 1.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 0 0-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 0 0-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 0 0-2.573-1.066-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 0 0-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 0 0 1.066-2.573c-.94-1.543.826 3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path></svg>
                        <span class="nav-text transition-opacity duration-300">Cài Đặt</span>
                    </button>
                </nav>
            </div>

            <div id="main-content-area" class="relative flex-1 flex flex-col ml-0 md:ml-64 transition-all duration-300 ease-in-out overflow-hidden">
                <div id="main-header" class="flex-shrink-0 bg-green-100 shadow-sm px-2 md:px-4 py-1.5 flex justify-between items-center gap-2 md:gap-4 h-14 transition-all">
                    <div class="flex items-center gap-2 overflow-hidden flex-shrink-0">
                        <h1 id="view-title" class="text-xs md:text-xl font-bold text-red-700 truncate"></h1>
                        <!-- Wifi Indicator Bar (Minimal Wave Style - ms unit) -->
                        <div id="network-indicator" class="flex items-center gap-1.5 px-1 transition-all flex-shrink-0">
                            <div id="network-wifi-svg" class="w-4 h-4 md:w-5 md:h-5">
                                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path id="wifi-arc-1" d="M12 20C12.5523 20 13 19.5523 13 19C13 18.4477 12.5523 18 12 18C11.4477 18 11 18.4477 11 19C11 19.5523 11.4477 20 12 20Z" fill="#CBD5E1"/>
                                    <path id="wifi-arc-2" d="M8.46447 15.4645C9.40215 14.5268 10.6739 14 12 14C13.3261 14 14.5979 14.5268 15.5355 15.4645" stroke="#CBD5E1" stroke-width="2" stroke-linecap="round"/>
                                    <path id="wifi-arc-3" d="M5.63604 12.636C7.32387 10.9482 9.53913 10 12 10C14.4609 10 16.6761 10.9482 18.364 12.636" stroke="#CBD5E1" stroke-width="2" stroke-linecap="round"/>
                                    <path id="wifi-arc-4" d="M2.80762 9.80762C5.23933 7.37591 8.44347 6 12 6C15.5565 6 18.7607 7.37591 21.1924 9.80762" stroke="#CBD5E1" stroke-width="2" stroke-linecap="round"/>
                                </svg>
                            </div>
                            <span id="network-speed-text" class="text-[9px] md:text-[11px] font-medium whitespace-nowrap uppercase tracking-tighter">-- ms</span>
                        </div>
                    </div>
                    <div id="notification-bar" class="text-[9px] md:text-sm text-gray-800 text-right whitespace-nowrap overflow-hidden flex-grow flex items-center justify-end">
                    </div>
                </div>
                <main class="flex-1 flex flex-col min-h-0 bg-gray-100 p-2 md:p-6 pb-16 md:pb-6 overflow-hidden">
                    <div id="view-phat-trien" class="app-view h-full overflow-y-auto no-scrollbar">
                        <div class="space-y-4 md:space-y-6">
                            <div class="grid grid-cols-3 gap-2 md:gap-6">
                                <div id="tq-card-san-pham" class="bg-white p-1 md:p-6 rounded-lg shadow-md flex flex-col md:flex-row justify-between items-center md:items-start hover:bg-blue-50 cursor-pointer transition-colors text-center md:text-left h-full">
                                    <div class="bg-blue-100 p-1 md:p-3 rounded-full mb-1 md:mb-0 md:order-2">
                                        <svg class="w-4 h-4 md:w-8 md:h-8 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 v2M7 7h10"></path></svg>
                                    </div>
                                    <div class="md:order-1 overflow-hidden">
                                        <p class="text-[9px] md:text-sm font-medium text-gray-500 leading-tight">Tổng Sản Phẩm</p>
                                        <p id="tq-stat-san-pham" class="text-xs md:text-3xl font-black text-blue-600">...</p>
                                        <p id="tq-sub-stat-san-pham" class="text-[8px] md:text-xs text-gray-500 mt-1 truncate"></p>
                                    </div>
                                </div>
                                <div id="tq-card-can-date" class="bg-white p-1 md:p-6 rounded-lg shadow-md flex flex-col md:flex-row justify-between items-center md:items-start hover:bg-indigo-50 cursor-pointer transition-colors text-center md:text-left h-full">
                                    <div class="bg-indigo-100 p-1 md:p-3 rounded-full mb-1 md:mb-0 md:order-2">
                                        <svg class="w-4 h-4 md:w-8 md:h-8 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
                                    </div>
                                    <div class="md:order-1 overflow-hidden">
                                        <p class="text-[9px] md:text-sm font-medium text-gray-500 leading-tight">Hết hạn trong 30 ngày</p>
                                        <p id="tq-stat-can-date" class="text-xs md:text-3xl font-black text-indigo-600">...</p>
                                        <p id="tq-sub-stat-can-date" class="text-[8px] md:text-xs text-gray-500 mt-1 truncate"></p>
                                    </div>
                                </div>
                                <div id="tq-card-het-han" class="bg-white p-1 md:p-6 rounded-lg shadow-md flex flex-col md:flex-row justify-between items-center md:items-start hover:bg-red-50 cursor-pointer transition-colors text-center md:text-left h-full">
                                    <div class="bg-red-100 p-1 md:p-3 rounded-full mb-1 md:mb-0 md:order-2">
                                        <svg class="w-4 h-4 md:w-8 md:h-8 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728A9 9 0 015.636 5.636m12.728 12.728L5.636 5.636"></path></svg>
                                    </div>
                                    <div class="md:order-1 overflow-hidden">
                                        <p class="text-[9px] md:text-sm font-medium text-gray-500 leading-tight">Hàng hết hạn</p>
                                        <p id="tq-stat-het-han" class="text-xs md:text-3xl font-black text-red-600">...</p>
                                        <p id="tq-sub-stat-het-han" class="text-[8px] md:text-xs text-gray-500 mt-1 truncate"></p>
                                    </div>
                                </div>
                            </div>

                            <!-- Dòng hàng phả hệ (Nâng cấp) -->
                            <div class="bg-white p-4 md:p-6 rounded-lg shadow-md">
                                <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-4 gap-3">
                                    <h3 class="text-sm md:text-lg font-bold text-gray-800 flex items-center">
                                        <svg class="w-5 h-5 mr-2 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 v2M7 7h10"></path></svg>
                                        Phân tích dòng hàng
                                    </h3>
                                    <!-- Toolbar Main Row: Vuốt ngang -->
                                    <div class="flex flex-nowrap items-center gap-2 w-full md:w-auto overflow-x-auto no-scrollbar pb-1">
                                        <!-- Chuyển chế độ NHẬP/XUẤT -->
                                        <div class="flex flex-shrink-0 items-center space-x-1 bg-gray-100 rounded-lg p-0.5 border border-gray-200 shadow-inner">
                                            <button id="tq-hierarchy-mode-xuat" class="hidden md:block px-3 py-1 rounded-md text-[10px] md:text-xs font-black transition-all bg-white shadow-sm text-blue-600 uppercase tracking-tighter" data-mode="xuat">Xuất</button>
                                            <button id="tq-hierarchy-mode-nhap" class="hidden md:block px-3 py-1 rounded-md text-[10px] md:text-xs font-black transition-all text-gray-400 hover:text-gray-600 uppercase tracking-tighter" data-mode="nhap">Nhập</button>
                                            
                                            <!-- Chấm màu mobile -->
                                            <div class="md:hidden flex items-center gap-3 px-2 py-1">
                                                <button id="tq-hierarchy-mode-xuat-dot" class="w-4 h-4 rounded-full border-2 border-red-200 bg-red-500 shadow-sm" data-mode="xuat" title="Xuất"></button>
                                                <button id="tq-hierarchy-mode-nhap-dot" class="w-4 h-4 rounded-full border-2 border-green-200 bg-gray-300" data-mode="nhap" title="Nhập"></button>
                                            </div>
                                        </div>

                                        <!-- Sub-mode pills (Tất cả, Đã xuất, Thiếu hàng) - Tích hợp chung thanh bộ lọc -->
                                        <div id="tq-hierarchy-submode-container" class="flex flex-shrink-0 items-center gap-1 bg-gray-50 border border-gray-200 rounded-lg p-0.5 shadow-sm transition-all overflow-hidden">
                                            <button data-submode="all" class="submode-pill px-2.5 py-1 rounded-md text-[9px] md:text-[10px] font-black transition-all bg-blue-600 text-white shadow-sm uppercase tracking-tighter">All</button>
                                            <button data-submode="xuat" class="submode-pill px-2.5 py-1 rounded-md text-[9px] md:text-[10px] font-black transition-all text-gray-400 hover:text-green-600 uppercase tracking-tighter">Xuất</button>
                                            <button data-submode="shortage" class="submode-pill px-2.5 py-1 rounded-md text-[9px] md:text-[10px] font-black transition-all text-gray-400 hover:text-red-600 uppercase tracking-tighter">Thiếu</button>
                                        </div>

                                        <!-- Bộ lọc dữ liệu -->
                                        <div class="relative flex-shrink-0">
                                            <button id="tq-hierarchy-yeu-cau-filter-btn" data-filter-key="yeu_cau" data-context="hierarchy" class="filter-btn text-left px-2 py-1.5 border rounded-md bg-white text-[10px] md:text-sm font-bold min-w-[70px] md:min-w-[80px] whitespace-nowrap shadow-sm">Yêu Cầu</button>
                                        </div>
                                        <div class="relative flex-shrink-0">
                                            <button id="tq-hierarchy-ma-vt-filter-btn" data-filter-key="ma_vt" data-context="hierarchy" class="filter-btn text-left px-2 py-1.5 border rounded-md bg-white text-[10px] md:text-sm font-bold min-w-[60px] md:min-w-[80px] whitespace-nowrap shadow-sm">Mã VT</button>
                                        </div>
                                        <div class="relative flex-shrink-0">
                                            <button id="tq-hierarchy-time-filter-btn" class="px-2 py-1.5 border rounded-md bg-white text-[10px] md:text-sm font-bold min-w-[70px] md:min-w-[80px] whitespace-nowrap shadow-sm">Thời Gian</button>
                                            <input type="hidden" id="tq-hierarchy-time-preset" value="all">
                                        </div>

                                        <!-- Date inputs hidden on main toolbar, only for custom -->
                                        <div id="tq-hierarchy-custom-dates" class="hidden flex flex-shrink-0 items-center gap-1">
                                            <input type="date" id="tq-hierarchy-date-from" class="px-2 py-1 border rounded-md text-[9px]">
                                            <input type="date" id="tq-hierarchy-date-to" class="px-2 py-1 border rounded-md text-[9px]">
                                        </div>

                                        <button id="tq-hierarchy-refresh-btn" class="flex-shrink-0 p-1.5 bg-blue-50 text-blue-600 rounded-md border border-blue-100 hover:bg-blue-100 transition-colors shadow-sm active:scale-90" title="Làm mới & Xóa lọc">
                                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg>
                                        </button>
                                    </div>
                                </div>

                                <div id="tq-hierarchy-container" class="min-h-[250px] md:min-h-[600px] max-h-[800px] overflow-y-auto no-scrollbar border rounded-lg p-3 bg-gray-50/50 shadow-inner">
                                    <div class="text-center py-10 text-gray-400 italic">Đang tải dữ liệu...</div>
                                </div>
                            </div>

                            <!-- PHẦN PHÂN TÍCH CHUYÊN SÂU (REGION & RECIPIENTS) -->
                            <div id="tq-analytics-section" class="bg-white p-3 md:p-6 rounded-2xl shadow-md border-t border-gray-100">
                                <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4">
                                    <h3 class="text-sm md:text-lg font-bold text-gray-800 flex items-center tracking-tight">
                                        <svg class="w-5 h-5 mr-2 text-indigo-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2m0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path></svg>
                                        Phân tích khu vực & Người nhận
                                    </h3>
                                    <!-- Thanh bộ lọc riêng cho Analytics -->
                                    <div class="flex flex-nowrap items-center gap-1.5 md:gap-2 w-full md:w-auto overflow-x-auto no-scrollbar">
                                        <div class="relative flex-shrink-0">
                                            <button id="tq-ana-nganh-filter-btn" data-filter-key="bu" data-context="analytics" class="filter-btn text-left px-2 py-1.5 border rounded-lg bg-white text-[9px] md:text-xs font-bold min-w-[60px] shadow-sm">Ngành (BU)</button>
                                        </div>
                                        <div class="relative flex-shrink-0">
                                            <button id="tq-ana-time-filter-btn" class="px-2 py-1.5 border rounded-lg bg-white text-[9px] md:text-xs font-bold min-w-[70px] shadow-sm">Thời Gian</button>
                                            <input type="hidden" id="tq-ana-time-preset" value="all">
                                        </div>
                                        <div class="relative flex-shrink-0">
                                            <button id="tq-ana-yeu-cau-filter-btn" data-filter-key="yeu_cau" data-context="analytics" class="filter-btn text-left px-2 py-1.5 border rounded-lg bg-white text-[9px] md:text-xs font-bold min-w-[70px] shadow-sm">Yêu Cầu</button>
                                        </div>
                                        <div class="relative flex-shrink-0">
                                            <button id="tq-ana-ma-vt-filter-btn" data-filter-key="ma_vt" data-context="analytics" class="filter-btn text-left px-2 py-1.5 border rounded-lg bg-white text-[9px] md:text-xs font-bold min-w-[70px] shadow-sm">Mã VT</button>
                                        </div>
                                        <button id="tq-ana-refresh-btn" class="flex-shrink-0 p-1.5 bg-gray-50 text-gray-400 rounded-lg border border-gray-100 hover:bg-gray-100 transition-colors shadow-sm" title="Reset lọc">
                                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg>
                                        </button>
                                    </div>
                                </div>

                                <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 md:gap-6">
                                    <!-- Khu vực -->
                                    <div class="flex flex-col bg-gray-50/50 rounded-2xl p-4 border border-gray-100">
                                        <div class="flex items-center justify-between mb-4">
                                            <h4 class="text-[9px] md:text-xs font-bold text-gray-400 tracking-wider">Phân tích theo khu vực</h4>
                                            <div id="tq-region-legend-container" class="flex items-center gap-2 text-[9px] font-bold"></div>
                                        </div>
                                        <div class="h-64 md:h-80">
                                            <canvas id="tq-region-line-chart"></canvas>
                                        </div>
                                    </div>
                                    <!-- Người nhận -->
                                    <div class="flex flex-col bg-gray-50/50 rounded-2xl p-4 border border-gray-100">
                                        <div class="flex items-center justify-between mb-4">
                                            <h4 class="text-[9px] md:text-xs font-bold text-gray-400 tracking-wider">Top người nhận hàng mẫu</h4>
                                            <!-- Toolbar nhỏ cho Recipient Analysis -->
                                            <div class="flex items-center gap-1.5 md:gap-2">
                                                <div class="relative">
                                                    <button id="tq-ana-nguoi-nhan-filter-btn" data-filter-key="nguoi_nhan" data-context="analytics" class="filter-btn text-center px-2 py-1 border rounded-lg bg-white text-[8px] md:text-[9px] font-bold shadow-sm min-w-[70px]">Người nhận</button>
                                                </div>
                                                <div class="flex items-center bg-white border border-gray-100 rounded-lg p-0.5 shadow-sm">
                                                    <button id="tq-ana-recipient-view-chart" class="p-1 px-2.5 rounded-md text-[8px] md:text-[9px] font-bold transition-all bg-blue-600 text-white shadow-sm" data-mode="chart">Chart</button>
                                                    <button id="tq-ana-recipient-view-list" class="p-1 px-2.5 rounded-md text-[8px] md:text-[9px] font-bold transition-all text-gray-400 hover:text-blue-600" data-mode="list">List</button>
                                                </div>
                                            </div>
                                        </div>
                                        <div id="tq-recipient-content-container" class="h-64 md:h-80 overflow-y-auto no-scrollbar relative">
                                            <canvas id="tq-recipient-stacked-bar-chart"></canvas>
                                            <div id="tq-recipient-hierarchy-list" class="hidden absolute inset-0 bg-transparent p-1 md:p-2"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="flex flex-col md:grid md:grid-cols-3 gap-3 md:gap-6">
                                <div class="bg-white pt-4 px-4 md:pt-6 md:px-6 pb-3 rounded-lg shadow-md flex flex-col md:col-span-2">
                                    <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-2 gap-2">
                                        <h3 class="text-sm md:text-lg font-semibold text-gray-800 flex items-center">
                                            <svg class="w-5 h-5 md:w-6 md:h-6 mr-2 text-orange-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                                            Cảnh Báo & Gợi Ý
                                        </h3>
                                        <div class="flex items-center gap-2 flex-wrap w-full md:w-auto">
                                             <div class="relative flex-grow md:flex-grow-0"><button id="tq-alert-filter-loai-btn" data-filter-key="loai" data-context="alerts" class="filter-btn text-left px-2 py-1 md:px-3 md:py-2 border rounded-md bg-white w-full md:w-36 text-[10px] md:text-sm">Loại</button></div>
                                             <div class="relative flex-grow md:flex-grow-0"><button id="tq-alert-filter-nganh-btn" data-filter-key="nganh" data-context="alerts" class="filter-btn text-left px-2 py-1 md:px-3 md:py-2 border rounded-md bg-white w-full md:w-36 text-[10px] md:text-sm">Ngành</button></div>
                                             <div class="relative flex-grow md:flex-grow-0"><button id="tq-alert-filter-phu-trach-btn" data-filter-key="phu_trach" data-context="alerts" class="filter-btn text-left px-2 py-1 md:px-3 md:py-2 border rounded-md bg-white w-full md:w-36 text-[10px] md:text-sm">Phụ Trách</button></div>
                                        </div>
                                    </div>
                                    <ul id="tq-alerts-list" class="space-y-1 md:space-y-3 overflow-y-auto h-32 md:h-72">
                                        <li class="text-center text-gray-500 py-4">Đang kiểm tra...</li>
                                    </ul>
                                </div>
                                <div class="bg-white pt-1 pb-0 px-4 md:p-6 rounded-lg shadow-md flex flex-col md:col-span-1">
                                    <div class="flex justify-between items-center mb-0 md:mb-4 flex-shrink-0">
                                        <h3 class="text-sm md:text-lg font-semibold text-gray-800">Tồn Kho</h3>
                                        <div class="relative">
                                            <button id="tq-inventory-chart-nganh-filter-btn" data-filter-key="nganh" data-context="inventory" class="filter-btn text-center px-2 py-1 md:px-3 md:py-2 border rounded-md bg-white w-24 md:w-32 shadow-sm text-[10px] md:text-sm">Ngành</button>
                                        </div>
                                    </div>
                                    <div id="tq-inventory-chart-container" class="relative flex-grow flex items-center justify-center min-h-[90px] md:min-h-[250px]">
                                        <canvas id="tq-inventory-chart"></canvas>
                                    </div>
                                </div>
                            </div>

                            <div class="flex flex-col md:grid md:grid-cols-1 gap-3 md:gap-6 pb-4">
                                <div class="bg-white p-4 md:p-6 rounded-lg shadow-md">
                                    <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-4 gap-2">
                                        <h3 class="text-sm md:text-lg font-semibold text-gray-800">Nhập/Xuất (30 ngày)</h3>
                                        <div id="tq-chart-toggle" class="flex items-center text-[10px] md:text-sm border border-gray-300 rounded-lg p-0.5">
                                            <button id="tq-chart-mode-quantity" class="px-2 py-1 md:px-3 md:py-1 rounded-md bg-gray-200 font-semibold">Số Lượng</button>
                                            <button id="tq-chart-mode-transaction" class="px-2 py-1 md:px-3 md:py-1 rounded-md text-gray-600">Giao Dịch</button>
                                        </div>
                                    </div>
                                    <div class="h-48 md:h-80">
                                        <canvas id="tq-activity-chart"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div id="view-san-pham" class="app-view hidden flex flex-col h-full overflow-hidden">
                         <div class="flex-shrink-0">
                            <div id="sp-mobile-toolbar" class="md:hidden flex items-center gap-2 mb-3 bg-white p-2 rounded-lg shadow-sm">
                                <input type="text" id="san-pham-search-mobile" placeholder="Tìm kiếm..." class="flex-grow px-2 py-1.5 border rounded-md text-[11px] min-w-0">
                                <button id="sp-mobile-filter-toggle" class="p-1.5 bg-gray-100 rounded-md text-gray-600">
                                    <svg class="w-3 h-3 md:w-5 md:h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"></path></svg>
                                </button>
                                <button id="san-pham-btn-excel-mobile" class="p-1.5 bg-green-100 rounded-md text-green-600">
                                    <svg class="w-3 h-3 md:w-5 md:h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>
                                </button>
                            </div>
                            
                            <div id="sp-filter-drawer-overlay" class="fixed inset-0 bg-black bg-opacity-50 z-40 hidden transition-opacity duration-300"></div>
                            <div id="sp-filter-drawer" class="fixed inset-y-0 right-0 w-64 bg-white z-50 transform translate-x-full transition-transform duration-300 shadow-xl flex flex-col">
                                <div class="p-4 border-b flex justify-between items-center">
                                    <h3 class="font-bold text-lg">Bộ Lọc</h3>
                                    <button id="sp-filter-drawer-close" class="text-gray-500 hover:text-gray-800">
                                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                                    </button>
                                </div>
                                <div class="p-4 flex-grow space-y-4 overflow-y-auto">
                                    <div class="space-y-2">
                                        <p class="text-xs font-semibold text-gray-500 uppercase">Tiêu chí</p>
                                        <button id="san-pham-filter-ma-vt-btn-mobile" data-filter-key="ma_vt" class="filter-btn w-full text-left px-3 py-2 border rounded-md bg-gray-50 text-sm">Mã VT</button>
                                        <button id="san-pham-filter-ten-vt-btn-mobile" data-filter-key="ten_vt" class="filter-btn w-full text-left px-3 py-2 border rounded-md bg-gray-50 text-sm">Tên Vật Tư</button>
                                        <button id="san-pham-filter-nganh-btn-mobile" data-filter-key="nganh" class="filter-btn w-full text-left px-3 py-2 border rounded-md bg-gray-50 text-sm">Ngành</button>
                                        <button id="san-pham-filter-phu-trach-btn-mobile" data-filter-key="phu_trach" class="filter-btn w-full text-left px-3 py-2 border rounded-md bg-gray-50 text-sm">Phụ Trách</button>
                                    </div>
                                </div>
                                <div class="p-4 border-t">
                                    <button id="san-pham-reset-filters-mobile" class="w-full bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 rounded-md">Xóa Lọc</button>
                                </div>
                            </div>

                            <div class="hidden md:block bg-white p-4 rounded-lg shadow-md mb-4">
                                <div class="flex flex-wrap gap-x-4 gap-y-2 items-center justify-between">
                                    <div class="flex flex-wrap gap-2 items-center w-full md:w-auto">
                                        <input type="text" id="san-pham-search" placeholder="Tìm kiếm chung..." class="px-3 py-2 border rounded-md w-full md:w-48">
                                        <div class="relative flex-grow md:flex-grow-0">
                                            <button id="san-pham-filter-ma-vt-btn" data-filter-key="ma_vt" class="filter-btn text-left px-3 py-2 border rounded-md bg-white w-full md:w-36 text-xs md:text-sm">Mã VT</button>
                                        </div>
                                        <div class="relative flex-grow md:flex-grow-0">
                                            <button id="san-pham-filter-ten-vt-btn" data-filter-key="ten_vt" class="filter-btn text-left px-3 py-2 border rounded-md bg-white w-full md:w-36 text-xs md:text-sm">Tên Vật Tư</button>
                                        </div>
                                        <div class="relative flex-grow md:flex-grow-0">
                                            <button id="san-pham-filter-nganh-btn" data-filter-key="nganh" class="filter-btn text-left px-3 py-2 border rounded-md bg-white w-full md:w-36 text-xs md:text-sm">Ngành</button>
                                        </div>
                                        <div class="relative flex-grow md:flex-grow-0">
                                            <button id="san-pham-filter-phu-trach-btn" data-filter-key="phu_trach" class="filter-btn text-left px-2 py-1 md:px-3 md:py-2 border rounded-md bg-white w-full md:w-36 text-xs md:text-sm">Phụ Trách</button>
                                        </div>
                                    </div>
                                    <div class="flex flex-wrap gap-2 items-center w-full md:w-auto justify-end mt-2 md:mt-0">
                                        <button id="san-pham-reset-filters" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-md text-xs md:text-sm">Xóa Lọc</button>
                                        <button id="san-pham-btn-excel" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-md text-xs md:text-sm">Excel</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="flex-1 min-h-0 bg-white rounded-lg shadow-md overflow-hidden">
                            <div class="table-container h-full">
                                <table class="min-w-full border-collapse">
                                    <thead class="bg-gray-200 sticky-header"><tr>
                                        <th class="px-2 md:px-4 py-2 text-center font-bold text-black uppercase tracking-wider border border-gray-300 w-[15%] md:w-[7%]">Ảnh</th>
                                        <th class="px-2 md:px-6 py-2 text-center font-bold text-black uppercase tracking-wider border border-gray-300 w-auto md:w-[20%]">Mã VT</th>
                                        <th class="hidden md:table-cell px-6 py-2 text-center font-bold text-black uppercase tracking-wider border border-gray-300" style="width: 40%;">Tên VT</th>
                                        <th class="px-2 md:px-6 py-2 text-center font-bold text-black uppercase tracking-wider border border-gray-300 w-1 whitespace-nowrap">Ngành</th>
                                        <th class="hidden md:table-cell px-6 py-2 text-center font-bold text-black uppercase tracking-wider border border-gray-300 w-1 whitespace-nowrap">Phụ Trách</th>
                                    </tr></thead>
                                    <tbody id="san-pham-table-body" class="bg-white"></tbody>
                                </table>
                            </div>
                        </div>

                        <div class="flex-shrink-0 flex flex-row justify-between items-center mt-2 md:mt-4 p-2 md:p-4 bg-white rounded-lg shadow-md flex-nowrap">
                            <span id="san-pham-pagination-info" class="text-[9px] md:text-sm text-gray-600 mr-2 whitespace-nowrap"></span>
                            <span id="san-pham-selection-info" class="hidden md:inline text-sm text-gray-600"></span>
                            <div class="flex items-center gap-1 flex-nowrap">
                                <select id="san-pham-items-per-page" class="hidden md:block px-3 py-1 border rounded-md bg-white">
                                    <option value="50">50</option>
                                    <option value="100">100</option>
                                </select>
                                <button id="san-pham-prev-page" class="px-2 py-1 md:px-3 border rounded-md bg-white text-[10px] md:text-sm">
                                    <svg class="w-3 h-3 fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
                                    <span class="hidden md:inline">Trước</span>
                                </button>
                                <div class="flex items-center gap-1 mx-1">
                                    <input type="number" id="san-pham-page-input" class="w-8 md:w-16 text-center border rounded-md p-0.5 text-[10px] md:text-sm" value="1" min="1">
                                    <span id="san-pham-total-pages" class="text-[10px] md:text-sm text-gray-700 whitespace-nowrap">/ 1</span>
                                </div>
                                <button id="san-pham-next-page" class="px-2 py-1 md:px-3 border rounded-md bg-white text-[10px] md:text-sm">
                                    <svg class="w-3 h-3 fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
                                    <span class="hidden md:inline">Sau</span>
                                </button>
                            </div>
                        </div>
                    </div>

                    <div id="view-ton-kho" class="app-view hidden flex flex-col h-full overflow-hidden">
                        <div class="flex-shrink-0">
                            <div id="tk-mobile-toolbar" class="md:hidden flex items-center gap-2 mb-3 bg-white p-2 rounded-lg shadow-sm">
                                <input type="text" id="ton-kho-search-mobile" placeholder="Tìm kiếm..." class="flex-grow px-2 py-1.5 border rounded-md text-[11px] min-w-0">
                                <button id="tk-mobile-filter-toggle" class="p-1.5 bg-gray-100 rounded-md text-gray-600">
                                    <svg class="w-3 h-3 md:w-5 md:h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"></path></svg>
                                </button>
                                <button id="ton-kho-btn-excel-mobile" class="p-1.5 bg-green-100 rounded-md text-green-600">
                                    <svg class="w-3 h-3 md:w-5 md:h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>
                                </button>
                            </div>
                            
                            <div id="tk-filter-drawer-overlay" class="fixed inset-0 bg-black bg-opacity-50 z-40 hidden transition-opacity duration-300"></div>
                            <div id="tk-filter-drawer" class="fixed inset-y-0 right-0 w-64 bg-white z-50 transform translate-x-full transition-transform duration-300 shadow-xl flex flex-col">
                                <div class="p-4 border-b flex justify-between items-center">
                                    <h3 class="font-bold text-lg">Bộ Lọc Tồn Kho</h3>
                                    <button id="tk-filter-drawer-close" class="text-gray-500 hover:text-gray-800">
                                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                                    </button>
                                </div>
                                <div class="p-4 flex-grow space-y-4 overflow-y-auto">
                                    <div class="space-y-2">
                                        <p class="text-xs font-semibold text-gray-500 uppercase">Tiêu chí</p>
                                        <button id="ton-kho-filter-ma-vt-btn-mobile" data-filter-key="ma_vt" class="filter-btn w-full text-left px-3 py-2 border rounded-md bg-gray-50 text-sm">Mã VT</button>
                                        <button id="ton-kho-filter-lot-btn-mobile" data-filter-key="lot" class="filter-btn w-full text-left px-3 py-2 border rounded-md bg-gray-50 text-sm">Lot</button>
                                        <button id="ton-kho-filter-date-btn-mobile" data-filter-key="date" class="filter-btn w-full text-left px-3 py-2 border rounded-md bg-gray-50 text-sm">Date</button>
                                        <button id="ton-kho-filter-tinh-trang-btn-mobile" data-filter-key="tinh_trang" class="filter-btn w-full text-left px-3 py-2 border rounded-md bg-gray-50 text-sm">Tình Trạng</button>
                                        <button id="ton-kho-filter-nganh-btn-mobile" data-filter-key="nganh" class="filter-btn w-full text-left px-3 py-2 border rounded-md bg-gray-50 text-sm">Ngành</button>
                                        <button id="ton-kho-filter-phu-trach-btn-mobile" data-filter-key="phu_trach" class="filter-btn w-full text-left px-3 py-2 border rounded-md bg-gray-50 text-sm">Phụ Trách</button>
                                    </div>
                                    <div class="pt-4 border-t">
                                        <p class="text-xs font-semibold text-gray-500 uppercase mb-2">Trạng thái</p>
                                        <div class="flex flex-col space-y-2">
                                            <button id="ton-kho-toggle-available-mobile" data-stock-mode="available" class="w-full px-3 py-2 border rounded-md text-sm text-left">Khả Dụng</button>
                                            <button id="ton-kho-toggle-all-mobile" data-stock-mode="all" class="w-full px-3 py-2 border rounded-md text-sm text-left">Tất Cả</button>
                                        </div>
                                    </div>
                                </div>
                                <div class="p-4 border-t">
                                    <button id="ton-kho-reset-filters-mobile" class="w-full bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 rounded-md">Xóa Lọc</button>
                                </div>
                            </div>

                            <div class="hidden md:block bg-white p-4 rounded-lg shadow-md mb-4">
                                <div class="flex flex-wrap gap-x-4 gap-y-2 items-center justify-between">
                                    <div class="flex flex-wrap gap-2 items-center w-full md:w-auto">
                                        <input type="text" id="ton-kho-search" placeholder="Tìm kiếm chung..." class="px-3 py-2 border rounded-md w-full md:w-48 text-xs">
                                        <div class="relative flex-grow md:flex-grow-0"><button id="ton-kho-filter-ma-vt-btn" data-filter-key="ma_vt" class="filter-btn text-left px-2 py-1 md:px-3 md:py-2 border rounded-md bg-white w-full md:w-32 text-[10px] md:text-sm">Mã VT</button></div>
                                        <div class="relative flex-grow md:flex-grow-0"><button id="ton-kho-filter-lot-btn" data-filter-key="lot" class="filter-btn text-left px-2 py-1 md:px-3 md:py-2 border rounded-md bg-white w-full md:w-28 text-[10px] md:text-sm">Lot</button></div>
                                        <div class="relative flex-grow md:flex-grow-0"><button id="ton-kho-filter-date-btn" data-filter-key="date" class="filter-btn text-left px-2 py-1 md:px-3 md:py-2 border rounded-md bg-white w-full md:w-28 text-[10px] md:text-sm">Date</button></div>
                                        <div class="relative flex-grow md:flex-grow-0"><button id="ton-kho-filter-tinh-trang-btn" data-filter-key="tinh_trang" class="filter-btn text-left px-2 py-1 md:px-3 md:py-2 border rounded-md bg-white w-full md:w-32 text-[10px] md:text-sm">Tình Trạng</button></div>
                                        <div class="relative flex-grow md:flex-grow-0"><button id="ton-kho-filter-nganh-btn" data-filter-key="nganh" class="filter-btn text-left px-2 py-1 md:px-3 md:py-2 border rounded-md bg-white w-full md:w-28 text-[10px] md:text-sm">Ngành</button></div>
                                        <div class="relative flex-grow md:flex-grow-0"><button id="ton-kho-filter-phu-trach-btn" data-filter-key="phu_trach" class="filter-btn text-left px-2 py-1 md:px-3 md:py-2 border rounded-md bg-white w-full md:w-32 text-[10px] md:text-sm">Phụ Trách</button></div>
                                        <div class="flex items-center space-x-1 bg-gray-200 rounded-full p-0.5 text-sm ml-0 md:ml-2 mt-2 md:mt-0 w-full md:w-auto justify-center">
                                            <button id="ton-kho-toggle-available" data-stock-mode="available" class="px-4 py-1 rounded-full flex-grow md:flex-grow-0 text-[10px] md:text-sm">Khả Dụng</button>
                                            <button id="ton-kho-toggle-all" data-stock-mode="all" class="px-4 py-1 rounded-full flex-grow md:flex-grow-0 text-[10px] md:text-sm">Tất Cả</button>
                                        </div>
                                    </div>
                                    <div class="flex flex-wrap gap-2 items-center w-full md:w-auto justify-end mt-2 md:mt-0">
                                        <button id="ton-kho-reset-filters" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-md text-[10px] md:text-sm">Xóa Lọc</button>
                                        <button id="ton-kho-btn-settings" class="bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-2 px-3 rounded-md text-[10px] md:text-sm flex items-center gap-1" title="Cài đặt cột hiển thị">
                                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 0 0 2.573 1.066c1.543.94 3.31.826 2.37 2.37a1.724 1.724 0 0 0 1.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 0 0-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 0 0-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 0 0-2.573-1.066-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 0 0-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 0 0 1.066-2.573c-.94-1.543.826 3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path></svg>
                                            <span class="hidden lg:inline">Cài Đặt Cột</span>
                                        </button>
                                        <button id="ton-kho-btn-excel" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-md text-[10px] md:text-sm">Excel</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="flex-1 min-h-0 bg-white rounded-lg shadow-md overflow-hidden relative">
                            <div class="table-container h-full">
                                <table class="min-w-full border-collapse w-full" style="table-layout: auto;">
                                    <thead class="bg-gray-200 sticky-header"><tr>
                                        <th class="tk-col-full-code hidden md:table-cell px-2 py-3 text-center font-bold text-black uppercase tracking-wider border border-gray-300">Code + Lot + EXP</th>
                                        <th class="px-2 md:px-4 py-2 text-center font-bold text-black uppercase tracking-wider border border-gray-300">Mã VT</th>
                                        <th class="tk-col-ten-vt hidden md:table-cell px-2 py-3 text-center font-bold text-black uppercase tracking-wider border border-gray-300">Tên VT</th>
                                        <th class="px-2 md:px-4 py-2 text-center font-bold text-black uppercase tracking-wider border border-gray-300">Lot</th>
                                        <th class="px-2 md:px-4 py-2 text-center font-bold text-black uppercase tracking-wider border border-gray-300">Date</th>
                                        <th class="tk-col-dau hidden md:table-cell px-2 py-3 text-center font-bold text-black uppercase tracking-wider border border-gray-300">Đầu<span id="ton-kho-header-dau-count" class="block font-bold text-black text-[9px] md:text-xs"></span></th>
                                        <th class="tk-col-nhap hidden md:table-cell px-2 py-3 text-center font-bold text-black uppercase tracking-wider border border-gray-300">Nhập<span id="ton-kho-header-nhap-count" class="block font-bold text-green-600 text-[9px] md:text-xs"></span></th>
                                        <th class="tk-col-xuat hidden md:table-cell px-2 py-3 text-center font-bold text-black uppercase tracking-wider border border-gray-300">Xuất<span id="ton-kho-header-xuat-count" class="block font-bold text-red-600 text-[9px] md:text-xs"></span></th>
                                        <th class="px-2 md:px-4 py-2 text-center font-bold text-black uppercase tracking-wider border border-gray-300">Cuối<span id="ton-kho-header-cuoi-count" class="hidden md:block font-bold text-red-600 text-[9px] md:text-xs"></span></th>
                                        <th class="tk-col-tinh-trang hidden md:table-cell px-1 py-2 border border-gray-300 text-center uppercase tracking-wider font-bold">T.Trạng</th>
                                        <th class="tk-col-tray hidden md:table-cell px-1 py-2 border border-gray-300 text-center uppercase tracking-wider font-bold">Tray</th>
                                        <th class="tk-col-nganh hidden md:table-cell px-1 md:px-4 py-2 text-[9px] md:text-sm text-gray-600 border border-gray-300 text-center whitespace-nowrap overflow-hidden text-ellipsis">Ngành</th>
                                        <th class="tk-col-phu-trach hidden md:table-cell px-1 py-2 text-sm text-gray-600 border border-gray-300 text-center">${tk.phu_trach || ''}</td>
                                        <th class="tk-col-ghi-chu hidden md:table-cell px-1 py-2 border border-gray-300 text-center">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mx-auto" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                                        </th>
                                    </tr></thead>
                                    <tbody id="ton-kho-table-body" class="bg-white"></tbody>
                                </table>
                            </div>
                            <!-- Floating Voice Mic Button -->
                            <button id="voice-assistant-trigger" class="absolute bottom-6 right-6 w-14 h-14 bg-blue-600 text-white rounded-full shadow-2xl flex items-center justify-center hover:bg-blue-700 transition-all active:scale-90 z-40 voice-pulse draggable-handle">
                                <svg class="w-6 h-6 pointer-events-none" fill="currentColor" viewBox="0 0 24 24"><path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z"/><path d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"/></svg>
                            </button>
                        </div>
                        <div class="flex-shrink-0 flex flex-row justify-between items-center mt-2 md:mt-4 p-2 md:p-4 bg-white rounded-lg shadow-md flex-nowrap overflow-hidden">
                            <span id="ton-kho-pagination-info" class="text-[9px] md:text-sm text-gray-600 mr-2 whitespace-nowrap flex-shrink-0"></span>
                            <div id="tk-summary-info" class="flex-grow flex justify-end md:justify-center overflow-hidden no-scrollbar px-2"></div>
                            <div class="flex items-center gap-1 flex-nowrap flex-shrink-0">
                                <select id="ton-kho-items-per-page" class="hidden md:block px-3 py-1 border rounded-md bg-white">
                                    <option value="50">50</option>
                                    <option value="100">100</option>
                                    <option value="200">200</option>
                                    <option value="500">500</option>
                                </select>
                                <button id="ton-kho-prev-page" class="px-2 py-1 md:px-3 border rounded-md bg-white text-[10px] md:text-sm">
                                    <svg class="w-3 h-3 fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
                                    <span class="hidden md:inline">Trước</span>
                                </button>
                                <div class="flex items-center gap-1 mx-1">
                                    <input type="number" id="ton-kho-page-input" class="w-8 md:w-16 text-center border rounded-md p-0.5 text-[10px] md:text-sm" value="1" min="1">
                                    <span id="ton-kho-total-pages" class="text-[10px] md:text-sm text-gray-700 whitespace-nowrap">/ 1</span>
                                </div>
                                <button id="ton-kho-next-page" class="px-2 py-1 md:px-3 border rounded-md bg-white text-[10px] md:text-sm">
                                    <svg class="w-3 h-3 fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
                                    <span class="hidden md:inline">Sau</span>
                                </button>
                            </div>
                        </div>
                    </div>

                    <div id="view-chi-tiet" class="app-view hidden flex flex-col h-full overflow-hidden"></div>
                    
                    <div id="view-cai-dat" class="app-view hidden h-full overflow-y-auto no-scrollbar">
                         <div class="flex flex-col lg:flex-row gap-6 items-start">
                            <div class="w-full lg:w-1/3 flex flex-col gap-6">
                                <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100 w-full">
                                    <h2 class="text-lg font-black mb-6 text-gray-800 border-b border-gray-50 pb-3 flex items-center gap-2">
                                        <svg class="w-5 h-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg>
                                        Thông tin cá nhân
                                    </h2>
                                    <form id="profile-form" class="space-y-5">
                                        <div class="flex flex-col items-center mb-6">
                                            <div class="relative group">
                                                <img id="profile-image-preview" src="" alt="Avatar" class="w-24 h-24 rounded-full object-cover border-4 border-white shadow-xl">
                                                <div class="absolute inset-0 flex items-center justify-center bg-black bg-opacity-40 rounded-full opacity-0 group-hover:opacity-100 transition-opacity cursor-pointer overflow-hidden" onclick="document.getElementById('profile-image-upload').click()">
                                                    <span class="text-white text-[10px] font-bold uppercase tracking-widest">Thay ảnh</span>
                                                </div>
                                            </div>
                                            <input type="file" id="profile-image-upload" accept="image/*" class="hidden">
                                            <input type="hidden" id="profile-current-avatar-url">
                                            <div class="flex flex-col items-center mt-3 gap-2 w-full">
                                                <button type="button" id="profile-remove-image-btn" class="text-red-500 text-[10px] font-bold hover:underline hidden uppercase tracking-wider">Gỡ ảnh hiện tại</button>
                                                <div id="profile-image-paste-area" class="w-full" tabindex="0">
                                                    <p class="text-[9px] text-gray-400 border border-dashed border-gray-200 rounded-xl p-2 text-center cursor-pointer hover:border-blue-300 transition-colors uppercase font-medium">
                                                        Click & Ctrl+V để dán ảnh
                                                    </p>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="space-y-4">
                                            <div>
                                                <label class="block text-[10px] font-black text-gray-400 uppercase tracking-widest mb-1.5 ml-1">Họ và Tên</label>
                                                <input type="text" id="profile-ho-ten" class="w-full bg-gray-50 border border-gray-100 rounded-xl p-3 text-sm focus:bg-white focus:ring-2 focus:ring-blue-500 outline-none transition-all" required>
                                            </div>
                                            <div>
                                                <label class="block text-[10px] font-black text-gray-400 uppercase tracking-widest mb-1.5 ml-1">Mật khẩu hiện tại</label>
                                                <input type="password" id="profile-old-password" class="w-full bg-gray-50 border border-gray-100 rounded-xl p-3 text-sm focus:bg-white focus:ring-2 focus:ring-blue-500 outline-none transition-all" placeholder="Xác nhận MK cũ để đổi mới">
                                            </div>
                                            <div class="grid grid-cols-2 gap-3">
                                                <div>
                                                    <label class="block text-[10px] font-black text-gray-400 uppercase tracking-widest mb-1.5 ml-1">MK Mới</label>
                                                    <input type="password" id="profile-new-password" class="w-full bg-gray-50 border border-gray-100 rounded-xl p-3 text-sm focus:bg-white focus:ring-2 focus:ring-blue-500 outline-none transition-all">
                                                </div>
                                                <div>
                                                    <label class="block text-[10px] font-black text-gray-400 uppercase tracking-widest mb-1.5 ml-1">Nhập lại</label>
                                                    <input type="password" id="profile-confirm-password" class="w-full bg-gray-50 border border-gray-100 rounded-xl p-3 text-sm focus:bg-white focus:ring-2 focus:ring-blue-500 outline-none transition-all">
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div id="profile-user-data-access-container" class="hidden pt-4 border-t border-gray-50">
                                            <label class="block text-[10px] font-black text-gray-400 uppercase tracking-widest mb-2 ml-1">Phạm vi dữ liệu</label>
                                            <div id="profile-xem-data-options"></div>
                                        </div>

                                        <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-black py-3.5 rounded-xl shadow-lg shadow-blue-100 transition-all active:scale-95 text-xs uppercase tracking-widest mt-4">Lưu thay đổi</button>
                                        
                                        <div class="pt-4 border-t border-gray-50">
                                            <button type="button" id="logout-btn" class="w-full bg-white border border-red-100 text-red-500 font-bold py-3 rounded-xl hover:bg-red-50 transition-all text-xs uppercase tracking-widest">Đăng xuất</button>
                                        </div>
                                    </form>
                                </div>
                            </div>

                            <div class="flex-1 w-full flex flex-col gap-6">
                                <div id="admin-panel" class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100 hidden">
                                    <div class="flex justify-between items-center mb-6 border-b border-gray-50 pb-3">
                                        <h2 class="text-lg font-black text-gray-800 flex items-center gap-2">
                                            <svg class="w-5 h-5 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"></path></svg>
                                            Quản trị hệ thống
                                        </h2>
                                        <span class="text-[10px] font-bold text-gray-400 bg-gray-50 px-3 py-1 rounded-full uppercase tracking-tighter">Thành viên & Quyền hạn</span>
                                    </div>
                                    <div id="user-list-container" class="max-h-[600px] overflow-y-auto no-scrollbar pr-1">
                                        <div id="user-list-body" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>
                                    </div>
                                </div>
                                
                                <div id="backup-restore-panel" class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100 hidden">
                                    <h2 class="text-lg font-black mb-6 text-gray-800 border-b border-gray-50 pb-3 flex items-center gap-2">
                                        <svg class="w-5 h-5 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"></path></svg>
                                        Dữ liệu & Bảo mật
                                    </h2>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8 pb-4">
                                        <div class="bg-gray-50 p-5 rounded-2xl border border-gray-100">
                                            <h3 class="font-bold text-gray-700 mb-2 flex items-center gap-2">
                                                <div class="w-2 h-2 rounded-full bg-green-500"></div>
                                                Sao lưu định kỳ
                                            </h3>
                                            <p class="text-xs text-gray-500 mb-4 leading-relaxed">Xuất toàn bộ cơ sở dữ liệu hiện tại ra file Excel để lưu trữ an toàn bên ngoài hệ thống.</p>
                                            <div class="flex flex-col gap-2">
                                                <button id="backup-excel-btn" class="w-full bg-white border border-green-200 text-green-600 hover:bg-green-600 hover:white font-bold py-2.5 rounded-xl text-xs flex items-center justify-center gap-2 transition-all shadow-sm">
                                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path></svg>
                                                    TẢI BẢN SAO EXCEL
                                                </button>
                                            </div>
                                        </div>
                                        <div class="bg-red-50 p-5 rounded-2xl border border-red-100">
                                            <h3 class="font-bold text-red-700 mb-2 flex items-center gap-2">
                                                <div class="w-2 h-2 rounded-full bg-red-500"></div>
                                                Phục hồi nâng cao
                                            </h3>
                                            <p class="text-[11px] text-red-500 mb-4 font-bold italic leading-tight uppercase">Cẩn trọng: Ghi đè toàn bộ dữ liệu hiện tại bằng tệp tin sao lưu của bạn.</p>
                                            <div class="flex items-center gap-2">
                                                <label for="restore-file-input" class="w-full cursor-pointer bg-red-600 hover:bg-red-700 text-white font-bold py-2.5 rounded-xl text-xs flex items-center justify-center gap-2 transition-all shadow-md">
                                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"></path></svg>
                                                    CHỌN TỆP PHỤ CỒI
                                                </label>
                                                <input type="file" id="restore-file-input" accept=".xlsx" class="hidden">
                                            </div>
                                            <p id="restore-file-name" class="text-[10px] text-red-400 mt-2 text-center truncate italic font-medium"></p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </main>
            </div>
        </div>
        
        <nav id="bottom-nav" class="fixed bottom-0 left-0 right-0 bg-gray-900 text-gray-400 flex justify-around items-center h-16 md:hidden z-40 border-t border-gray-700 shadow-[0_-2px_10px_rgba(0,0,0,0.3)]">
            <button data-view="view-phat-trien" class="nav-button mobile-nav-btn flex flex-col items-center justify-center w-full h-full active">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6z"></path></svg>
                <span class="text-[10px] mt-1">Tổng Quan</span>
            </button>
            <button data-view="view-san-pham" class="nav-button mobile-nav-btn flex flex-col items-center justify-center w-full h-full">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 v2M7 7h10"></path></svg>
                <span class="text-[10px] mt-1">Sản Phẩm</span>
            </button>
            <button data-view="view-ton-kho" class="nav-button mobile-nav-btn flex flex-col items-center justify-center w-full h-full">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4"></path></svg>
                <span class="text-[10px] mt-1">Tồn Kho</span>
            </button>
            <button data-view="view-chi-tiet" class="nav-button mobile-nav-btn flex flex-col items-center justify-center w-full h-full">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>
                <span class="text-[10px] mt-1">Chi Tiết</span>
            </button>
            <button data-view="view-cai-dat" class="nav-button mobile-nav-btn flex flex-col items-center justify-center w-full h-full">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 0 0 2.573 1.066c1.543.94 3.31.826 2.37 2.37a1.724 1.724 0 0 0 1.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 0 0-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 0 0-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 0 0-2.573-1.066-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 0 0-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 0 0 1.066-2.573c-.94-1.543.826 3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path></svg>
                <span class="text-[10px] mt-1">Cài Đặt</span>
            </button>
        </nav>
    </div>

    <!-- Voice Assistant API Key Settings Modal -->
    <div id="voice-settings-modal" class="hidden fixed inset-0 z-[100] flex items-center justify-center modal-backdrop">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-sm mx-4 p-6 modal-content-custom animate-in zoom-in duration-200">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-black text-gray-800 uppercase tracking-tight">Cấu hình Trợ lý</h3>
                <button id="close-voice-settings-modal" class="text-gray-400 hover:text-gray-600 text-2xl">&times;</button>
            </div>
            <div class="space-y-4">
                <div>
                    <input type="password" id="voice-api-key-input" class="w-full bg-gray-50 border border-gray-100 rounded-xl p-3 text-sm focus:bg-white focus:ring-2 focus:ring-blue-500 outline-none transition-all font-mono" placeholder="Nhập mã API Key mới...">
                </div>
                <div class="pt-2">
                    <button id="save-voice-settings-btn" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-black py-3 rounded-xl shadow-lg transition-all active:scale-95 text-xs uppercase tracking-widest">Cập nhật Key</button>
                </div>
            </div>
        </div>
    </div>

    <div id="chi-tiet-vt-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center modal-backdrop">
        <div class="bg-white rounded-2xl shadow-2xl w-full md:max-w-6xl mx-4 flex flex-col max-h-[92vh] md:h-[90vh] overflow-hidden">
            <div class="p-2.5 md:p-6 border-b bg-gray-50 flex justify-between items-center flex-shrink-0">
                <div>
                    <h3 class="text-sm md:text-2xl font-black text-gray-800 leading-tight"></h3>
                    <div id="ct-vt-info-header" class="mt-0.5"></div>
                </div>
                <button type="button" id="close-ct-vt-modal" class="text-gray-400 hover:text-gray-600 text-2xl md:text-3xl">&times;</button>
            </div>
            <div class="p-3 md:p-8 overflow-y-auto flex-1 no-scrollbar space-y-3 md:space-y-6">
                <div id="ct-vt-action-bar" class="flex flex-row justify-between items-center gap-2 bg-blue-50 p-2 md:p-4 rounded-xl border border-blue-100 flex-shrink-0">
                    <div class="text-[10px] md:text-lg flex items-center gap-2 md:gap-4 font-black">
                        <div class="flex items-center gap-1">
                            <span class="text-gray-500 text-[8px] md:text-xs uppercase font-bold">Gốc</span>
                            <span id="ct-vt-original-qty" class="text-blue-700">0</span>
                        </div>
                        <div class="h-4 w-px bg-gray-300"></div>
                        <div class="flex items-center gap-1">
                            <span class="text-gray-500 text-[8px] md:text-xs uppercase font-bold">Đã chia</span>
                            <span id="ct-vt-distributed-qty" class="text-green-700">0</span>
                        </div>
                    </div>
                    <button type="button" id="add-ct-vt-row-btn" class="bg-indigo-600 text-white w-7 h-7 md:w-auto md:h-auto md:px-6 md:py-2.5 rounded-full md:rounded-xl shadow-md hover:bg-indigo-700 transition-all flex items-center justify-center gap-2 active:scale-90">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M12 4v16m8-8H4"></path></svg>
                        <span class="hidden md:inline uppercase tracking-widest text-[11px] font-black">Thêm</span>
                    </button>
                </div>
                
                <div class="border rounded-xl overflow-hidden">
                    <div class="overflow-y-auto max-h-[200px] md:max-h-none no-scrollbar">
                        <table class="w-full border-collapse min-w-[400px]">
                            <thead class="bg-gray-100 sticky top-0 z-20">
                                <tr>
                                    <th class="border p-2 text-[9px] md:text-sm font-black text-gray-600 text-center w-[25%] md:w-1/4">Người nhận</th>
                                    <th class="border p-2 text-[9px] md:text-sm font-black text-gray-600 text-center w-10 md:w-16 px-1">SL</th>
                                    <th class="border p-2 text-[9px] md:text-sm font-black text-gray-600 text-center">Địa điểm</th>
                                    <th class="border p-2 text-[9px] md:text-sm font-black text-gray-600 text-center">Ghi chú</th>
                                    <th class="border p-2 text-[9px] md:text-sm font-black text-gray-600 text-center w-8 md:w-10 ct-vt-col-delete">Xóa</th>
                                </tr>
                            </thead>
                            <tbody id="chi-tiet-vt-table-body"></tbody>
                        </table>
                    </div>
                    <div id="ct-vt-empty-state" class="hidden text-center py-8 text-gray-400 text-[10px] md:text-sm italic">Chưa có thông tin phân bổ.</div>
                </div>

                <div class="bg-gray-50 rounded-xl p-2 md:p-4 border border-gray-100 flex-shrink-0">
                    <h4 class="text-[8px] md:text-xs font-black text-gray-400 uppercase tracking-[0.2em] mb-2 md:mb-4 flex items-center gap-1.5">
                        <svg class="w-3 h-3 md:w-4 md:h-4 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                        Lịch sử cập nhật chi tiết
                    </h4>
                    <div id="ct-vt-history-list" class="space-y-1.5 md:space-y-3 max-h-[100px] md:max-h-[180px] overflow-y-auto no-scrollbar pr-1 md:pr-2">
                        <p class="text-[8px] md:text-xs text-gray-400 italic">Dữ liệu lịch sử...</p>
                    </div>
                </div>
            </div>
            <div class="p-2.5 md:p-4 border-t bg-gray-50 flex justify-end gap-2 md:gap-3 flex-shrink-0">
                <button type="button" id="cancel-ct-vt-btn" class="px-4 md:px-6 py-1.5 md:py-2 bg-gray-200 text-gray-700 rounded-xl font-bold hover:bg-gray-300 text-[10px] md:text-sm">Hủy</button>
                <button type="button" id="save-ct-vt-btn" class="px-5 md:px-8 py-1.5 md:py-2 bg-blue-600 text-white rounded-xl font-bold shadow-lg hover:bg-blue-700 active:scale-95 transition-all text-[10px] md:text-sm">Lưu</button>
            </div>
        </div>
    </div>
    
    <div id="confirm-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center modal-backdrop">
        <div class="bg-white rounded-lg shadow-xl p-6 w-full max-w-sm modal-content-custom">
            <h3 id="confirm-title" class="text-lg font-bold text-gray-800 mb-2">Xác nhận</h3>
            <p id="confirm-message" class="text-gray-600 mb-4 text-[10px] md:text-base">Bạn có chắc muốn tiếp tục?</p>
            <div class="flex justify-end gap-3">
                <button id="confirm-cancel-btn" class="px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300 text-[10px] md:text-sm">Hủy</button>
                <button id="confirm-ok-btn" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 text-[10px] md:text-sm">Đồng ý</button>
            </div>
        </div>
    </div>
    
    <div id="san-pham-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center modal-backdrop">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-lg mx-4 md:mx-0 flex flex-col max-h-[90vh] modal-content-custom">
            <div class="p-4 border-b modal-header-custom">
                <h3 class="text-lg font-bold text-gray-800" id="san-pham-modal-title">Thêm Sản Phẩm Mới</h3>
            </div>
            <div class="p-6 overflow-y-auto modal-content-custom">
                <form id="san-pham-form" class="space-y-4">
                    <input type="hidden" id="san-pham-edit-mode-ma-vt">
                    <div class="flex items-center space-x-4 mb-4">
                        <div class="relative group">
                            <img id="san-pham-modal-image-preview" src="https://upload.wikimedia.org/wikipedia/commons/thumb/3/3f/Placeholder_view_vector.svg/681px-Placeholder_view_vector.svg.png" alt="Ảnh SP" class="w-24 h-24 rounded-md object-cover border-2 border-gray-200">
                            <div class="absolute inset-0 flex items-center justify-center bg-black bg-opacity-40 rounded-md opacity-0 group-hover:opacity-100 transition-opacity cursor-pointer" onclick="document.getElementById('san-pham-modal-image-upload').click()">
                                <span class="text-white text-xs">Đổi ảnh</span>
                            </div>
                        </div>
                        <input type="file" id="san-pham-modal-image-upload" accept="image/*" class="hidden">
                        <input type="hidden" id="san-pham-modal-hinh-anh-url-hien-tai">
                        <div class="flex-grow">
                            <button type="button" id="san-pham-modal-remove-image-btn" class="text-red-500 text-sm hover:underline hidden">Xóa ảnh</button>
                            <div class="mt-2" id="san-pham-image-paste-area" tabindex="0">
                                <p class="text-xs text-gray-500 border border-dashed border-gray-300 rounded p-2 cursor-text focus:border-blue-500 focus:outline-none">
                                    Click vào đây rồi Ctrl+V để dán ảnh
                                </p>
                            </div>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Mã Vật Tư</label>
                        <input type="text" id="san-pham-modal-ma-vt" class="mt-1 block w-full border rounded-md p-2 uppercase" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Tên Vật Tư</label>
                        <input type="text" id="san-pham-modal-ten-vt" class="mt-1 block w-full border rounded-md p-2" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Ngành</label>
                        <input type="text" id="san-pham-modal-nganh" class="mt-1 block w-full border rounded-md p-2">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Phụ Trách</label>
                        <input type="text" id="san-pham-modal-phu-trach" list="phu-trach-list" class="mt-1 block w-full border rounded-md p-2">
                        <datalist id="phu-trach-list"></datalist>
                    </div>
                    <div class="flex justify-end gap-3 pt-4">
                        <button type="button" id="cancel-san-pham-btn" class="px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300">Hủy</button>
                        <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">Lưu</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div id="ton-kho-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center modal-backdrop">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-lg mx-4 md:mx-0 flex flex-col max-h-[90vh] modal-content-custom">
            <div class="p-4 border-b modal-header-custom">
                <h3 class="text-lg font-bold text-gray-800" id="ton-kho-modal-title">Chi Tiết Tồn Kho</h3>
            </div>
            <div class="p-6 overflow-y-auto modal-content-custom">
                <form id="ton-kho-form" class="space-y-4">
                    <input type="hidden" id="ton-kho-edit-mode-ma-vach">
                    <div id="ton-kho-modal-ma-vach-display-container" class="mb-4 p-2 bg-gray-100 rounded text-center">
                        <span class="text-sm font-bold text-gray-700">Mã Vạch: </span>
                        <span id="ton-kho-modal-ma-vach-display" class="font-mono text-blue-600 font-bold">...</span>
                        <input type="hidden" id="ton-kho-modal-ma-vach">
                        <div id="ton-kho-modal-ma-vach-status" class="text-xs mt-1 h-4"></div>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Mã VT</label>
                            <input type="text" id="ton-kho-modal-ma-vt" class="mt-1 block w-full border rounded-md p-2 uppercase" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Tên VT</label>
                            <input type="text" id="ton-kho-modal-ten-vt" class="mt-1 block w-full border rounded-md p-2 bg-gray-100" readonly>
                        </div>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Lot</label>
                            <input type="text" id="ton-kho-modal-lot" class="mt-1 block w-full border rounded-md p-2">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Date (dd/mm/yyyy)</label>
                            <input type="text" id="ton-kho-modal-date" placeholder="dd/mm/yyyy" class="mt-1 block w-full border rounded-md p-2">
                        </div>
                    </div>
                    <div class="grid grid-cols-3 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Tồn Đầu</label>
                            <input type="number" id="ton-kho-modal-ton-dau" class="mt-1 block w-full border rounded-md p-2" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Nhập</label>
                            <input type="number" id="ton-kho-modal-nhap" class="mt-1 block w-full border rounded-md p-2" value="0">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Xuất</label>
                            <input type="number" id="ton-kho-modal-xuat" class="mt-1 block w-full border rounded-md p-2" value="0">
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Tình Trạng</label>
                        <div id="ton-kho-modal-tinh-trang-container"></div>
                    </div>
                    <div class="grid grid-cols-3 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Tray</label>
                            <input type="text" id="ton-kho-modal-tray" class="mt-1 block w-full border rounded-md p-2">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Ngành</label>
                            <input type="text" id="ton-kho-modal-nganh" class="mt-1 block w-full border rounded-md p-2 bg-gray-100" readonly>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Phụ Trách</label>
                            <input type="text" id="ton-kho-modal-phu-trach" class="mt-1 block w-full border rounded-md p-2 bg-gray-100" readonly>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Ghi chú</label>
                        <textarea id="ton-kho-modal-note" class="mt-1 block w-full border rounded-md p-2 h-20"></textarea>
                    </div>
                    <div class="flex justify-end gap-3 pt-4">
                        <button type="button" id="cancel-ton-kho-btn" class="px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300">Hủy</button>
                        <button type="button" id="close-ton-kho-view-btn" class="hidden px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300">Đóng</button>
                        <button type="submit" id="save-ton-kho-btn" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700" disabled>Lưu</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div id="ton-kho-settings-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center modal-backdrop">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-md mx-4 flex flex-col modal-content-custom">
            <div class="p-4 border-b">
                <h3 class="text-lg font-bold text-gray-800">Cài đặt hiển thị cột</h3>
                <p class="text-xs text-gray-500 mt-1">Chọn các cột bạn muốn hiển thị trên màn hình máy tính.</p>
            </div>
            <div class="p-6 overflow-y-auto max-h-[60vh]">
                <div id="ton-kho-column-toggles" class="grid grid-cols-1 gap-4"></div>
            </div>
            <div class="p-4 border-t flex justify-end">
                <button id="ton-kho-settings-close-btn" class="px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 font-bold shadow-sm">Xong</button>
            </div>
        </div>
    </div>

    <div id="image-viewer-modal" class="hidden fixed inset-0 z-[60] flex items-center justify-center modal-backdrop p-4" onclick="document.getElementById('image-viewer-modal').classList.add('hidden')">
        <div class="relative max-w-full max-h-full" onclick="event.stopPropagation()">
            <img id="image-viewer-img" src="" alt="Full Size" class="max-w-screen max-h-screen rounded-md shadow-lg object-contain">
            <button id="close-image-viewer-btn" class="absolute top-2 right-2 bg-black bg-opacity-50 text-white rounded-full p-2 hover:bg-opacity-75">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
            </button>
        </div>
    </div>

    <div id="print-preview-modal" class="hidden fixed z-[70] bg-white rounded-lg shadow-2xl flex flex-col overflow-hidden resize border border-gray-300" style="width: 80vw; height: 90vh; top: 5vh; left: 10vw;">
        <div id="print-preview-header" class="flex justify-between items-center p-3 bg-gray-100 border-b cursor-move select-none">
            <h3 id="print-preview-title" class="font-bold text-gray-700">Xem trước khi in</h3>
            <div class="flex items-center gap-2">
                <button id="print-preview-maximize-btn" class="text-gray-500 hover:text-gray-800 p-1" title="Mở tab mới">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path></svg>
                </button>
                <button id="print-preview-close-btn" class="text-gray-500 hover:text-red-600 p-1" title="Đóng">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>
            </div>
        </div>
        <div class="flex-grow bg-gray-500 relative">
            <iframe id="print-preview-iframe" class="w-full h-full border-none"></iframe>
        </div>
    </div>

    <div id="excel-export-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center modal-backdrop">
        <div class="bg-white rounded-lg shadow-xl p-4 w-full max-w-sm modal-content-custom">
            <h3 class="text-base font-bold text-gray-800 mb-4 text-center">Tùy chọn xuất Excel</h3>
            <div class="space-y-3">
                <button id="excel-export-filtered-btn" class="w-full py-3 px-4 bg-blue-100 text-blue-800 rounded-md hover:bg-blue-200 font-medium text-left text-xs md:text-sm">
                    Xuất dữ liệu đang hiển thị (đã lọc)
                </button>
                <button id="excel-export-all-btn" class="w-full py-3 px-4 bg-green-100 text-green-800 rounded-md hover:bg-green-200 font-medium text-left text-xs md:text-sm">
                    Xuất toàn bộ dữ liệu
                </button>
            </div>
            <div class="mt-6 flex justify-center">
                <button id="excel-export-cancel-btn" class="text-gray-500 hover:text-gray-700 text-[10px] md:text-sm uppercase font-bold tracking-wider">Hủy bỏ</button>
            </div>
        </div>
    </div>
    
    <div id="password-reset-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center modal-backdrop">
        <div class="bg-white rounded-lg shadow-xl p-6 w-full max-w-sm modal-content-custom">
            <h3 class="text-lg font-bold text-gray-800 mb-2">Đặt lại mật khẩu</h3>
            <p class="text-sm text-gray-600 mb-4">Đặt lại mật khẩu cho: <span id="reset-user-gmail-display" class="font-bold"></span></p>
            <form id="password-reset-form">
                <input type="hidden" id="reset-user-gmail">
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700">Mật khẩu mới</label>
                    <input type="text" id="reset-new-password" class="mt-1 block w-full border rounded-md p-2" required minlength="6">
                </div>
                <div class="flex justify-end gap-3">
                    <button type="button" id="cancel-reset-btn" class="px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300">Hủy</button>
                    <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">Lưu</button>
                </div>
            </form>
        </div>
    </div>

    <template id="filter-popover-template">
        <div class="filter-popover">
            <input type="text" class="filter-search-input w-full px-2 py-1 border rounded mb-2 text-xs md:text-sm" placeholder="Tìm kiếm...">
            <div class="filter-options-list space-y-1"></div>
            <div class="mt-2 flex justify-between items-center">
                <span class="filter-selection-count text-[10px] md:text-sm text-gray-600 font-medium"></span>
                <div class="flex items-center gap-2">
                    <button type="button" class="filter-toggle-all-btn text-[10px] md:text-xs font-medium text-blue-600 hover:underline">Tất cả</button>
                    <button class="filter-apply-btn px-3 py-1 bg-blue-600 text-white text-[10px] md:text-sm rounded hover:bg-blue-700">Áp dụng</button>
                </div>
            </div>
        </div>
    </template>
    
    <template id="autocomplete-popover-template">
        <div class="absolute z-999 bg-white border border-gray-300 rounded-md shadow-lg mt-1 max-h-60 overflow-y-auto">
            <div class="autocomplete-options-list"></div>
        </div>
    </template>

    <template id="chi-tiet-action-menu-template">
        <div class="action-popover">
            <button class="action-item ct-action-view-purpose">
                <svg class="w-4 h-4 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path></svg>
                Xem Phân Bổ
            </button>
            <button class="action-item ct-action-edit-vt">
                <svg class="w-4 h-4 text-indigo-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path></svg>
                Chỉnh Sửa
            </button>
        </div>
    </template>

    <!-- Template for Hierarchy Action Menu (Ma VT) -->
    <template id="hierarchy-vt-action-menu-template">
        <div class="action-popover">
            <div class="px-3 py-2 border-b bg-gray-50 text-[10px] font-bold flex gap-2 justify-center border-t border-gray-100 rounded-t-xl">
                 <span class="text-green-600">N: <span id="h-pop-n">0</span></span>
                 <span class="text-red-600">X: <span id="h-pop-x">0</span></span>
                 <span class="text-blue-600">T: <span id="h-pop-t">0</span></span>
            </div>
            <button class="action-item h-action-stock">
                <svg class="w-4 h-4 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"></path></svg>
                Xem Tồn Kho
            </button>
            <button class="action-item h-action-card">
                <svg class="w-4 h-4 text-indigo-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>
                Xem Thẻ Kho
            </button>
        </div>
    </template>

    <!-- Template for Hierarchy Action Menu (Ma NX) -->
    <template id="hierarchy-nx-action-menu-template">
        <div class="action-popover">
            <button class="action-item h-nx-action-view">
                <svg class="w-4 h-4 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path></svg>
                Xem Phân Bổ
            </button>
            <button class="action-item h-nx-action-edit">
                <svg class="w-4 h-4 text-indigo-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path></svg>
                Chỉnh sửa
            </button>
            <button class="action-item h-nx-action-goto">
                <svg class="w-4 h-4 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6"></path></svg>
                Xem Chi tiết
            </button>
        </div>
    </template>

    <script src="app.js" type="module"></script>
</body>
</html>
